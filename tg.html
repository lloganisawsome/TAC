<!doctype html>
<html lang="en">
<head>
    <link rel="stylesheet" href="rightclick.css">
    <link rel="stylesheet" href="custom-cursor.css">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TAC Mega Casino</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0a0a0b; --panel:#111113; --panel-hover:#1a1a1c; --card:#153e24; 
    --accent:#22c55e; --accent-dim:rgba(34,197,94,0.1); --muted:#71717a; 
    --glass:rgba(255,255,255,0.03); --border:rgba(255,255,255,0.06);
    --shadow:0 8px 30px rgba(2,20,10,0.6);
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
  html,body{height:100%;margin:0;background:var(--bg);color:#eaffef}
  
  /* Sidebar */
  .sidebar {
    position: fixed;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 70px;
    background: var(--panel);
    border: 1px solid var(--accent);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    transition: all 0.3s ease;
    z-index: 1000;
    box-shadow: 0 0 20px var(--accent-dim);
  }
  .sidebar.collapsed {
    width: 0;
    padding: 0;
    border: none;
    margin-left: -10px;
    overflow: hidden;
  }
  .logo-container {
    margin-bottom: 16px;
    padding: 4px;
    transition: opacity 0.3s;
  }
  .sidebar.collapsed .logo-container {
    opacity: 0;
  }
  .logo {
    width: 62px;
    height: 62px;
    border-radius: 8px;
  }
  .nav-items {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 100%;
    padding: 0 8px;
    transition: opacity 0.3s;
  }
  .sidebar.collapsed .nav-items {
    opacity: 0;
  }
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 54px;
    height: 54px;
    border-radius: 10px;
    text-decoration: none;
    color: var(--accent);
    transition: all 0.2s ease;
    cursor: pointer;
  }
  .nav-item:hover {
    background: var(--accent-dim);
  }
  .nav-item.active {
    background: var(--accent-dim);
    border: 1px solid var(--accent);
  }
  .nav-item svg {
    width: 24px;
    height: 24px;
    margin-bottom: 2px;
  }
  .nav-item span {
    font-size: 9px;
    font-weight: 500;
  }
  .toggle-btn {
    position: fixed;
    left: 90px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 36px;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1001;
  }
  .toggle-btn:hover {
    background: var(--panel-hover);
    border-color: var(--accent);
  }
  .toggle-btn svg {
    width: 14px;
    height: 14px;
    color: #fff;
    transition: transform 0.3s ease;
  }
  .toggle-btn.collapsed {
    left: 10px;
  }
  .toggle-btn.collapsed svg {
    transform: rotate(180deg);
  }
  
  .app{max-width:1100px;margin:18px auto 18px 100px;padding:18px;transition:margin-left 0.3s;}
  .app.expanded{margin-left:30px;}
  header{display:flex;align-items:center;gap:14px}
  h1{margin:0;font-size:20px}
  .status {margin-left:auto;text-align:right}
  .chips {background:var(--panel);padding:8px 12px;border-radius:10px;border:1px solid var(--border)}
  nav{display:flex;gap:8px;margin:14px 0;flex-wrap:wrap}
  .tab{background:var(--card);padding:8px 12px;border-radius:10px;border:1px solid var(--border);cursor:pointer;color:var(--accent);font-weight:700}
  .tab.inactive{opacity:0.6;color:var(--muted);font-weight:600}
  .container{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:16px;box-shadow:var(--shadow);min-height:520px}
  .screen{display:none;opacity:0;transition:opacity .35s ease;min-height:420px}
  .screen.active{display:block;opacity:1}
  .row{display:flex;gap:12px}
  .card{flex:1;background:var(--panel);padding:12px;border-radius:12px;border:1px solid var(--border)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:linear-gradient(180deg,var(--accent),#08b55a);border:none;padding:10px 14px;border-radius:10px;font-weight:700;color:#042;cursor:pointer;box-shadow:0 4px 0 rgba(0,0,0,0.3)}
  button.secondary{background:transparent;border:1px solid var(--border);color:var(--muted);box-shadow:none}
  button:disabled{opacity:0.5;cursor:not-allowed}
  input[type=number]{padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit}
  select{padding:8px;border-radius:8px;border:1px solid var(--border);background:transparent;color:inherit}
  .small{font-size:13px;color:var(--muted)}
  .game-title{display:flex;align-items:center;gap:8px;margin-bottom:8px}
  .reel{width:86px;height:86px;border-radius:10px;background:#071b12;display:flex;align-items:center;justify-content:center;font-size:34px;border:1px solid var(--border)}
  .slot-row{display:flex;gap:8px}
  .message{margin-top:8px;color:var(--muted)}
  .bets{display:flex;gap:6px;align-items:center}
  .bar{height:10px;background:#042412;border-radius:10px;overflow:hidden}
  .bar-fill{height:100%;background:linear-gradient(90deg,var(--accent),#04d480);width:0%}
  .footer{margin-top:10px;color:var(--muted);font-size:13px;text-align:center}
  .track{height:120px;position:relative;background:linear-gradient(90deg,#0e341c,#063217);border-radius:8px;overflow:hidden;padding:8px}
  .horse{position:absolute;left:8px;top:8px;height:28px;display:flex;align-items:center;gap:8px}
  .horse .name{font-weight:700;color:#042}
  .cards{display:flex;gap:6px;align-items:center}
  .card-face{width:56px;height:80px;border-radius:6px;background:#072218;display:flex;align-items:center;justify-content:center;font-size:20px;border:1px solid var(--border)}
  .hud{display:flex;gap:12px;align-items:center}
  .tiny{font-size:12px;color:var(--muted)}
  .sports-matchup{padding:10px;border:1px solid var(--border);border-radius:8px;margin-bottom:10px}
  .sports-matchup button{margin-right:4px}
  .wheel-container{position:relative;display:inline-block}
  .wheel-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:16px;font-weight:800;color:var(--accent);pointer-events:none;text-shadow:0 2px 8px rgba(0,0,0,0.8)}
  .multiplayer-panel{background:var(--panel);border:1px solid var(--border);border-radius:8px;padding:12px;margin-top:12px}
  .player-list{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .player-item{background:rgba(255,255,255,0.02);padding:8px;border-radius:6px;display:flex;justify-content:space-between;align-items:center}
  .player-item.ready{border:2px solid var(--accent)}
  
  /* Chess Board */
  .chess-board{display:grid;grid-template-columns:repeat(8,50px);grid-template-rows:repeat(8,50px);margin:20px auto;width:fit-content;border:3px solid var(--accent)}
  .chess-square{width:50px;height:50px;display:flex;align-items:center;justify-content:center;font-size:32px;cursor:pointer;user-select:none}
  .chess-square.white{background:#f0d9b5}
  .chess-square.black{background:#b58863}
  .chess-square.selected{background:var(--accent)!important}
  .chess-square.valid-move{background:rgba(34,197,94,0.3)!important}
  
  @media (max-width:900px){
    .row{flex-direction:column}
    .track{height:220px}
    .app{margin-left:24px;}
    .sidebar{display:none}
    .toggle-btn{display:none}
    .chess-board{grid-template-columns:repeat(8,40px);grid-template-rows:repeat(8,40px)}
    .chess-square{width:40px;height:40px;font-size:24px}
  }
</style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  <div class="logo-container">
    <img src="taclogos/green.png" alt="Logo" class="logo" id="logo">
  </div>
  <nav class="nav-items">
    <a href="index.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
      <span>Home</span>
    </a>
    <a href="chat.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
        <circle cx="8" cy="10" r="1.5"/>
        <circle cx="12" cy="10" r="1.5"/>
        <circle cx="16" cy="10" r="1.5"/>
      </svg>
      <span>Chat</span>
    </a>
    <a href="notgames.html" class="nav-item active">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M21.58 16.09l-1.09-7.66A3.996 3.996 0 0016.53 5H7.47a3.996 3.996 0 00-3.96 3.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75h0c1.55 0 2.75-1.37 2.53-2.91zM11 11H9v2H8v-2H6v-1h2V8h1v2h2v1zm4-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm2 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
      </svg>
      <span>Games</span>
    </a>
    <a href="phone.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/>
      </svg>
      <span>Phone</span>
    </a>
    <a href="apps.html" class="nav-item">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
      </svg>
      <span>All Apps</span>
    </a>
  </nav>
</aside>

<button class="toggle-btn" id="toggleBtn">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="15 18 9 12 15 6"/>
  </svg>
</button>

<div class="app" id="app">
  <header>
    <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#08b55a);display:flex;align-items:center;justify-content:center;font-weight:800;color:#022;font-size:24px">TG</div>
    <div>
      <h1>TAC Gambling</h1>
      <div class="small">Good luck.</div>
    </div>
    <div class="status">
      <div class="chips">Chips: <strong id="uiChips">0</strong></div>
      <div class="small">High: <span id="uiHigh">0</span></div>
    </div>
  </header>

  <nav id="tabs">
    <div class="tab" data-screen="slots">Slots</div>
    <div class="tab inactive" data-screen="coins">Coin & Dice</div>
    <div class="tab inactive" data-screen="wheel">Wheel</div>
    <div class="tab inactive" data-screen="blackjack">Blackjack</div>
    <div class="tab inactive" data-screen="chess">Chess</div>
    <div class="tab inactive" data-screen="roulette">Roulette</div>
    <div class="tab inactive" data-screen="horses">Horse Racing</div>
    <div class="tab inactive" data-screen="texas">Texas Hold'em</div>
    <div class="tab inactive" data-screen="poker">5-card Poker</div>
    <div class="tab inactive" data-screen="crash">Crash</div>
    <div class="tab inactive" data-screen="hilo">Hi-Lo</div>
    <div class="tab inactive" data-screen="sports">Sports Hub</div>
  </nav>

  <div class="container">
    <div class="row" style="margin-bottom:12px;align-items:center">
      <div style="flex:1" class="card">
        <div class="hud">
          <div class="small">Bet amount</div>
          <input id="betAmount" type="number" min="1" value="10" style="width:120px" />
          <div class="bets">
            <button id="bet10" class="secondary">+10</button>
            <button id="bet50" class="secondary">+50</button>
            <button id="bet100" class="secondary">+100</button>
            <button id="addChips" class="secondary">Add 100 (demo)</button>
          </div>
        </div>
        <div class="small" style="margin-top:6px">Difficulty: <select id="difficulty"><option>Easy</option><option selected>Medium</option><option>Hard</option><option>Impossible</option></select></div>
      </div>

      <div style="width:260px" class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Pot Progress (shared)</div>
            <div class="bar" style="width:180px"><div id="potFill" class="bar-fill"></div></div>
            <div class="small">Pot: <span id="pot">0</span></div>
          </div>
          <div style="text-align:right">
            <div class="small">Cooldown</div>
            <div id="cooldown" class="small">Ready</div>
          </div>
        </div>
      </div>
    </div>

    <section id="screens">
      <div id="slots" class="screen active">
        <div class="game-title"><h2>Slots Hub</h2><div class="small">Multiple machines ‚Äî different payouts & styles.</div></div>
        <div class="row">
          <div class="card">
            <h3 class="small">Classic 3-reel</h3>
            <div class="slot-row" id="classicReels">
              <div class="reel" id="c1">üçí</div>
              <div class="reel" id="c2">üçã</div>
              <div class="reel" id="c3">üîî</div>
            </div>
            <div style="margin-top:10px">
              <button id="spinClassic">Spin Classic</button>
              <div class="message small" id="classicMsg">‚Äî</div>
            </div>
          </div>

          <div class="card">
            <h3 class="small">High Roller 3-reel</h3>
            <div style="display:flex;gap:6px">
              <div class="reel" id="h1">üçí</div>
              <div class="reel" id="h2">üçã</div>
              <div class="reel" id="h3">üîî</div>
            </div>
            <div style="margin-top:10px">
              <button id="spinHigh">Spin High Roller</button>
              <div class="message small" id="highMsg">‚Äî</div>
            </div>
          </div>

          <div class="card">
            <h3 class="small">Mega Jackpot</h3>
            <div style="display:flex;justify-content:center;margin-top:8px;gap:6px">
              <div class="reel" id="m1">üíé</div>
              <div class="reel" id="m2">7Ô∏è‚É£</div>
              <div class="reel" id="m3">‚≠ê</div>
            </div>
            <div style="margin-top:10px">
              <button id="spinMega">Spin Mega</button>
              <div class="message small" id="megaMsg">‚Äî</div>
            </div>
          </div>
        </div>
        
        <div class="row" style="margin-top:12px">
          <div class="card">
            <h3 class="small">Diamond 5-reel</h3>
            <div style="display:flex;gap:6px">
              <div class="reel" id="d1">üíé</div>
              <div class="reel" id="d2">üíé</div>
              <div class="reel" id="d3">üíé</div>
              <div class="reel" id="d4">üíé</div>
              <div class="reel" id="d5">üíé</div>
            </div>
            <div style="margin-top:10px">
              <button id="spinDiamond">Spin Diamond</button>
              <div class="message small" id="diamondMsg">‚Äî</div>
            </div>
          </div>

          <div class="card">
            <h3 class="small">Lucky 7s</h3>
            <div style="display:flex;gap:6px;justify-content:center">
              <div class="reel" id="l1">7Ô∏è‚É£</div>
              <div class="reel" id="l2">üçÄ</div>
              <div class="reel" id="l3">7Ô∏è‚É£</div>
            </div>
            <div style="margin-top:10px">
              <button id="spinLucky">Spin Lucky</button>
              <div class="message small" id="luckyMsg">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div id="coins" class="screen">
        <div class="game-title"><h2>Coin Flip & Dice</h2><div class="small">Simple, fast, fair.</div></div>
        <div class="row">
          <div class="card">
            <h3 class="small">Coin Flip</h3>
            <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
              <button id="coinFlip">Flip Coin</button><div class="small">Last: <span id="coinLast">‚Äî</span></div>
            </div>
            <div class="message small" id="coinMsg">‚Äî</div>
          </div>

          <div class="card">
            <h3 class="small">Dice (Higher / Lower)</h3>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <button id="rollHigh">Bet High (4-6)</button>
              <button id="rollLow">Bet Low (1-3)</button>
            </div>
            <div class="message small" id="diceMsg">‚Äî</div>
          </div>

          <div class="card">
            <h3 class="small">Quick Bets</h3>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="betAllIn" class="secondary">All In (demo)</button>
              <button id="half" class="secondary">Half Bet</button>
            </div>
            <div class="message small" id="qbMsg">‚Äî</div>
          </div>
        </div>
      </div>

      <div id="wheel" class="screen">
        <div class="game-title"><h2>Wheel of Fortune</h2><div class="small">Spin to win big prizes!</div></div>
        <div class="row">
          <div class="card" style="text-align:center">
            <div class="wheel-container">
              <canvas id="wheelCanvas" width="400" height="400" style="max-width:100%"></canvas>
              <div class="wheel-label">SPIN</div>
            </div>
            <div style="margin-top:12px">
              <button id="spinWheel">Spin Wheel</button>
              <div class="message small" id="wheelMsg">‚Äî</div>
            </div>
          </div>
          <div class="card">
            <h3 class="small">Prizes</h3>
            <div class="small" style="line-height:1.8">
              üü¢ WIN x2 <br>
              üîµ WIN x5 <br>
              üü£ WIN x10 <br>
              üü° JACKPOT x50 <br>
              üî¥ LOSE <br>
              ‚ö™ BONUS SPIN
            </div>
          </div>
        </div>
      </div>

      <div id="blackjack" class="screen">
        <div class="game-title"><h2>Blackjack PvP</h2><div class="small">Play against another player! One is dealer, one is player. Winner takes both bets!</div></div>
        
        <div class="multiplayer-panel">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
            <div class="small">Multiplayer Mode (2 players max)</div>
            <div style="display:flex;gap:8px">
              <input id="bjBetInput" type="number" min="10" value="50" placeholder="Bet" style="width:80px" />
              <button id="bjCreateRoom" class="secondary">Create Room</button>
              <button id="bjJoinRoom" class="secondary">Join Room</button>
            </div>
          </div>
          <input id="bjRoomCode" type="text" placeholder="Room code" style="width:150px;margin-top:8px" />
          <div id="bjRoomInfo" class="small" style="margin-top:8px">Not in a room</div>
          <div class="player-list" id="bjPlayerList"></div>
        </div>

        <div class="row" style="margin-top:12px">
          <div class="card" id="bjTable">
            <div><strong>Your Hand</strong></div>
            <div class="cards" id="bjPlayerCards"></div>
            <div class="small">Player total: <span id="bjPlayerTotal">0</span></div>
            <hr>
            <div><strong>Opponent</strong></div>
            <div class="cards" id="bjDealerCards"></div>
            <div class="small">Opponent total: <span id="bjDealerTotal">?</span></div>
            <div style="margin-top:8px">
              <button id="bjHit" class="secondary">Hit</button>
              <button id="bjStand" class="secondary">Stand</button>
              <button id="bjReady" class="secondary">Ready</button>
              <div class="message small" id="bjMsg">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div id="chess" class="screen">
        <div class="game-title"><h2>Chess PvP</h2><div class="small">Play chess against another player! Winner takes both bets!</div></div>
        
        <div class="multiplayer-panel">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
            <div class="small">Chess Match (2 players, equal bets)</div>
            <div style="display:flex;gap:8px">
              <input id="chessBetInput" type="number" min="10" value="50" placeholder="Bet" style="width:80px" />
              <button id="chessCreateRoom" class="secondary">Create Room</button>
              <button id="chessJoinRoom" class="secondary">Join Room</button>
            </div>
          </div>
          <input id="chessRoomCode" type="text" placeholder="Room code" style="width:150px;margin-top:8px" />
          <div id="chessRoomInfo" class="small" style="margin-top:8px">Not in a room</div>
          <div class="player-list" id="chessPlayerList"></div>
          <button id="chessReady" class="secondary" style="margin-top:8px">Ready to Play</button>
        </div>

        <div class="row" style="margin-top:12px">
          <div class="card">
            <div id="chessBoard" class="chess-board"></div>
            <div class="message small" id="chessMsg" style="text-align:center">Create or join a room to start</div>
            <div style="text-align:center;margin-top:12px">
              <button id="chessResign" class="secondary">Resign</button>
            </div>
          </div>
        </div>
      </div>

      <div id="roulette" class="screen">
        <div class="game-title"><h2>Roulette</h2><div class="small">Bet on numbers, red/black, odd/even.</div></div>
        <div class="row">
          <div class="card">
            <div class="small">Pick type</div>
            <div style="display:flex;gap:6px;margin-top:8px">
              <button id="betRed">Red</button>
              <button id="betBlack">Black</button>
              <button id="betEven">Even</button>
              <button id="betOdd">Odd</button>
            </div>
            <div style="margin-top:12px">
              <div class="small">Or pick a number (0-36)</div>
              <input id="rouletteNumber" type="number" min="0" max="36" value="7"/>
              <button id="betNumber">Bet Number</button>
            </div>
            <div class="message small" id="rouletteMsg">‚Äî</div>
          </div>
        </div>
      </div>

      <div id="horses" class="screen">
        <div class="game-title"><h2>Horse Racing</h2><div class="small">Pick a horse, watch the race!</div></div>
        <div class="row">
          <div class="card" style="flex:1">
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
              <div class="small">Pick Horse</div>
              <select id="horsePick"></select>
              <div class="small">Race Mode</div>
              <select id="raceMode">
                <option value="sprint">Sprint</option>
                <option value="lap" selected>Standard</option>
                <option value="long">Marathon</option>
              </select>
              <button id="startRace">Start Race</button>
            </div>
            <div style="margin-top:12px" class="track" id="track"></div>
            <div class="message small" id="horseMsg">‚Äî</div>
          </div>
        </div>
      </div>

      <div id="texas" class="screen">
        <div class="game-title"><h2>Texas Hold'em</h2><div class="small">Heads-up vs AI</div></div>
        <div class="row">
          <div class="card">
            <div class="small">Your hole cards</div>
            <div class="cards" id="thPlayerCards"></div>
            <div class="small">Community</div>
            <div class="cards" id="thCommunity"></div>
            <div style="margin-top:8px">
              <button id="thDeal">Deal Hand</button>
              <button id="thNext" class="secondary">Next Stage</button>
              <div class="message small" id="thMsg">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div id="poker" class="screen">
        <div class="game-title"><h2>5-Card Poker</h2><div class="small">Draw up to 3 cards.</div></div>
        <div class="row">
          <div class="card">
            <div class="small">Your hand</div>
            <div class="cards" id="pokerPlayer"></div>
            <div style="margin-top:8px">
              <button id="pokerDeal">Deal</button>
              <button id="pokerDraw" class="secondary">Draw Selected</button>
              <div class="message small" id="pokerMsg">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div id="crash" class="screen">
        <div class="game-title"><h2>Crash Game</h2><div class="small">Cash out before it crashes!</div></div>
        <div class="row">
          <div class="card" style="text-align:center">
            <div style="font-size:64px;font-weight:800;color:var(--accent);margin:20px 0" id="crashMultiplier">1.00x</div>
            <div style="margin-top:20px">
              <button id="crashStart">Start Game</button>
              <button id="crashCashout" class="secondary">Cash Out</button>
              <div class="message small" id="crashMsg">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <div id="hilo" class="screen">
        <div class="game-title"><h2>Hi-Lo Card Game</h2><div class="small">Guess if next card is higher or lower!</div></div>
        <div class="row">
          <div class="card">
            <div style="text-align:center">
              <div class="card-face" style="width:120px;height:160px;font-size:48px;margin:0 auto" id="hiloCard">?</div>
              <div class="small" style="margin-top:12px">Current: <span id="hiloValue">‚Äî</span></div>
            </div>
            <div style="display:flex;gap:8px;margin-top:20px;justify-content:center">
              <button id="hiloHigher">Higher</button>
              <button id="hiloLower">Lower</button>
              <button id="hiloStart" class="secondary">New Game</button>
            </div>
            <div class="message small" id="hiloMsg">‚Äî</div>
            <div class="small" style="margin-top:8px">Streak: <span id="hiloStreak">0</span> | Multiplier: <span id="hiloMult">1.0x</span></div>
          </div>
        </div>
      </div>

      <div id="sports" class="screen">
        <div class="game-title"><h2>Sports Betting Hub</h2><div class="small">Live odds on major sports!</div></div>
        <div class="row">
          <div class="card">
            <h3 class="small">üèà NFL</h3>
            <div class="sports-matchup">
              <div class="small">Phoenix Firebirds vs Seattle Slayers</div>
              <button data-sport="nfl" data-team="Firebirds" data-odds="2.1">Firebirds (2.1x)</button>
              <button data-sport="nfl" data-team="Slayers" data-odds="1.7">Slayers (1.7x)</button>
            </div>
            <div class="sports-matchup">
              <div class="small">Dallas Mavericks vs Green Bay Guardians</div>
              <button data-sport="nfl" data-team="Mavericks" data-odds="1.9">Mavericks (1.9x)</button>
              <button data-sport="nfl" data-team="Guardians" data-odds="2.3">Guardians (2.3x)</button>
            </div>

            <h3 class="small" style="margin-top:16px">üèÄ NBA</h3>
            <div class="sports-matchup">
              <div class="small">LA Lakers vs Boston Celtics</div>
              <button data-sport="nba" data-team="Lakers" data-odds="1.5">Lakers (1.5x)</button>
              <button data-sport="nba" data-team="Celtics" data-odds="2.5">Celtics (2.5x)</button>
            </div>
            <div class="sports-matchup">
              <div class="small">Golden State Warriors vs Miami Heat</div>
              <button data-sport="nba" data-team="Warriors" data-odds="1.8">Warriors (1.8x)</button>
              <button data-sport="nba" data-team="Heat" data-odds="2.2">Heat (2.2x)</button>
            </div>
            <div class="sports-matchup">
              <div class="small">Brooklyn Nets vs Phoenix Suns</div>
              <button data-sport="nba" data-team="Nets" data-odds="2.0">Nets (2.0x)</button>
              <button data-sport="nba" data-team="Suns" data-odds="1.9">Suns (1.9x)</button>
            </div>

            <h3 class="small" style="margin-top:16px">üèà NCAAF</h3>
            <div class="sports-matchup">
              <div class="small">Ohio State vs Michigan</div>
              <button data-sport="ncaaf" data-team="Buckeyes" data-odds="1.3">Buckeyes (1.3x)</button>
              <button data-sport="ncaaf" data-team="Wolverines" data-odds="3.0">Wolverines (3.0x)</button>
            </div>
            <div class="sports-matchup">
              <div class="small">Alabama Crimson Tide vs Georgia Bulldogs</div>
              <button data-sport="ncaaf" data-team="Tide" data-odds="1.6">Tide (1.6x)</button>
              <button data-sport="ncaaf" data-team="Bulldogs" data-odds="2.4">Bulldogs (2.4x)</button>
            </div>

            <h3 class="small" style="margin-top:16px">‚öΩ Soccer</h3>
            <div class="sports-matchup">
              <div class="small">Manchester United vs Liverpool</div>
              <button data-sport="soccer" data-team="United" data-odds="2.1">Man Utd (2.1x)</button>
              <button data-sport="soccer" data-team="Liverpool" data-odds="1.8">Liverpool (1.8x)</button>
            </div>
            <div class="sports-matchup">
              <div class="small">Real Madrid vs Barcelona</div>
              <button data-sport="soccer" data-team="Madrid" data-odds="1.7">Madrid (1.7x)</button>
              <button data-sport="soccer" data-team="Barcelona" data-odds="2.3">Barca (2.3x)</button>
            </div>

            <h3 class="small" style="margin-top:16px">‚öæ MLB</h3>
            <div class="sports-matchup">
              <div class="small">New York Yankees vs Boston Red Sox</div>
              <button data-sport="mlb" data-team="Yankees" data-odds="1.9">Yankees (1.9x)</button>
              <button data-sport="mlb" data-team="RedSox" data-odds="2.0">Red Sox (2.0x)</button>
            </div>

            <h3 class="small" style="margin-top:16px">üèí NHL</h3>
            <div class="sports-matchup">
              <div class="small">Toronto Maple Leafs vs Montreal Canadiens</div>
              <button data-sport="nhl" data-team="Leafs" data-odds="1.6">Leafs (1.6x)</button>
              <button data-sport="nhl" data-team="Canadiens" data-odds="2.5">Canadiens (2.5x)</button>
            </div>

            <div class="message small" id="sportsMsg">Select a match and team.</div>
          </div>
        </div>
      </div>

    </section>

    <div class="footer">Copyright 2025 TAC Gambling</div>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
/* Firebase Init */
const firebaseConfig = {
  apiKey: "AIzaSyBQslLAFRlIRJqsiJ2WWeTNslO067bzKYM",
  authDomain: "taclogin-ab38e.firebaseapp.com",
  databaseURL: "https://taclogin-ab38e-default-rtdb.firebaseio.com",
  projectId: "taclogin-ab38e",
  storageBucket: "taclogin-ab38e.firebasestorage.app",
  messagingSenderId: "937853298051",
  appId: "1:937853298051:web:119ccc7b5499514bd442b6"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

/* Theme System */
const themeColors = {
  green: { primary: '#22c55e', dim: 'rgba(34, 197, 94, 0.1)', shadow: 'rgba(34, 197, 94, 0.15)' },
  blue: { primary: '#3b82f6', dim: 'rgba(59, 130, 246, 0.1)', shadow: 'rgba(59, 130, 246, 0.15)' },
  red: { primary: '#ef4444', dim: 'rgba(239, 68, 68, 0.1)', shadow: 'rgba(239, 68, 68, 0.15)' },
  cyan: { primary: '#06b6d4', dim: 'rgba(6, 182, 212, 0.1)', shadow: 'rgba(6, 182, 212, 0.15)' },
  pink: { primary: '#ec4899', dim: 'rgba(236, 72, 153, 0.1)', shadow: 'rgba(236, 72, 153, 0.15)' },
  purple: { primary: '#8b5cf6', dim: 'rgba(139, 92, 246, 0.1)', shadow: 'rgba(139, 92, 246, 0.15)' },
  yellow: { primary: '#eab308', dim: 'rgba(234, 179, 8, 0.1)', shadow: 'rgba(234, 179, 8, 0.15)' },
  orange: { primary: '#f97316', dim: 'rgba(249, 115, 22, 0.1)', shadow: 'rgba(249, 115, 22, 0.15)' },
  white: { primary: '#ffffff', dim: 'rgba(255, 255, 255, 0.1)', shadow: 'rgba(255, 255, 255, 0.15)' },
  whiteout: { primary: '#ffffff', dim: 'rgba(255, 255, 255, 0.05)', shadow: 'rgba(255, 255, 255, 0.1)' }
};

/* Sidebar Toggle */
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('toggleBtn');
const app = document.getElementById('app');

toggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('collapsed');
  toggleBtn.classList.toggle('collapsed');
  app.classList.toggle('expanded');
});

/* State Management */
const STATE_KEY = 'mega_casino_state_v1';
let state = { chips: 500, high: 500, pot: 0 };
const POT_MAX = 1000;
const COOLDOWN_MS = 600;
let cooldown = false;

function rngInt(max){ const a = new Uint32Array(1); crypto.getRandomValues(a); return a[0] % max; }
function randomItem(arr){ return arr[rngInt(arr.length)]; }

function loadState(){ try{ const s=JSON.parse(localStorage.getItem(STATE_KEY)); if(s && typeof s.chips==='number'){ state = s; } }catch(e){} enforceMin(); updateUI(); }
function saveState(){ localStorage.setItem(STATE_KEY, JSON.stringify(state)); updateUI(); }
function enforceMin(){ if(state.chips <= 0) state.chips = 1; saveState(); }
function award(n){ state.chips += n; if(state.chips > state.high) state.high = state.chips; saveState(); }
function spend(n){ if(state.chips < n) return false; state.chips -= n; state.pot = Math.min(POT_MAX, state.pot + Math.min(n,50)); saveState(); return true; }
function updateUI(){ 
  document.getElementById('uiChips').textContent = state.chips; 
  document.getElementById('uiHigh').textContent = state.high; 
  document.getElementById('pot').textContent = state.pot; 
  const pct = Math.round(100*(state.pot/POT_MAX)); 
  document.getElementById('potFill').style.width = pct + '%'; 
}

async function actionWithCooldown(fn){
  if(cooldown){ document.getElementById('cooldown').textContent = 'Wait'; return; }
  cooldown = true; document.getElementById('cooldown').textContent = 'Busy';
  try{ await fn(); }catch(e){ console.error(e); }
  setTimeout(()=>{ cooldown=false; document.getElementById('cooldown').textContent = 'Ready'; }, COOLDOWN_MS);
}

function diffFactor(){
  const d = document.getElementById('difficulty').value;
  if(d==='Easy') return 1.25;
  if(d==='Medium') return 1.0;
  if(d==='Hard') return 0.8;
  if(d==='Impossible') return 0.5;
  return 1;
}

function setMsg(id,txt){ const el = document.getElementById(id); if(el) el.textContent = txt; }

/* Tab Switching */
document.querySelectorAll('#tabs .tab').forEach(t=>{
  t.addEventListener('click', ()=> {
    document.querySelectorAll('#tabs .tab').forEach(x=>x.classList.add('inactive'));
    t.classList.remove('inactive');
    const screen = t.dataset.screen;
    document.querySelectorAll('.screen').forEach(s=> s.classList.remove('active'));
    document.getElementById(screen).classList.add('active');
    window.scrollTo({top:0,behavior:'smooth'});
  });
});

/* Shared Bet Buttons */
document.getElementById('bet10').addEventListener('click', ()=> { document.getElementById('betAmount').value = Math.max(1, Number(document.getElementById('betAmount').value||1)+10); });
document.getElementById('bet50').addEventListener('click', ()=> { document.getElementById('betAmount').value = Math.max(1, Number(document.getElementById('betAmount').value||1)+50); });
document.getElementById('bet100').addEventListener('click', ()=> { document.getElementById('betAmount').value = Math.max(1, Number(document.getElementById('betAmount').value||1)+100); });
document.getElementById('addChips').addEventListener('click', ()=>{ award(100); setMsg('classicMsg','Added 100 chips'); });

/* SLOTS */
const SYMBOLS = ['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üíé'];
function pickSymbol(){ return SYMBOLS[rngInt(SYMBOLS.length)]; }

document.getElementById('spinClassic').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('classicMsg','Not enough chips'); return; }
  setMsg('classicMsg','Spinning...');
  for(let i=0;i<8;i++){
    document.getElementById('c1').textContent = pickSymbol();
    document.getElementById('c2').textContent = pickSymbol();
    document.getElementById('c3').textContent = pickSymbol();
    await new Promise(r=>setTimeout(r,60 + i*20));
  }
  const s1=pickSymbol(), s2=pickSymbol(), s3=pickSymbol();
  document.getElementById('c1').textContent=s1; document.getElementById('c2').textContent=s2; document.getElementById('c3').textContent=s3;
  const df = diffFactor();
  let win = 0;
  if(s1===s2 && s2===s3){ win = Math.floor(bet * (6 * df)); }
  else if(s1===s2 || s2===s3 || s1===s3){ win = Math.floor(bet * (1.5 * df)); }
  if(win>0){ award(win); setMsg('classicMsg',`Triple! +${win}`); state.pot = Math.max(0, state.pot - Math.floor(win/10)); saveState(); }
  else setMsg('classicMsg','No match.');
}));

document.getElementById('spinHigh').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(5,Math.floor(Number(document.getElementById('betAmount').value)||5));
  if(!spend(bet)){ setMsg('highMsg','Not enough chips'); return; }
  setMsg('highMsg','Spinning...');
  for(let i=0;i<10;i++){
    document.getElementById('h1').textContent = pickSymbol();
    document.getElementById('h2').textContent = pickSymbol();
    document.getElementById('h3').textContent = pickSymbol();
    await new Promise(r=>setTimeout(r,50 + i*18));
  }
  const s1=pickSymbol(), s2=pickSymbol(), s3=pickSymbol();
  document.getElementById('h1').textContent=s1; document.getElementById('h2').textContent=s2; document.getElementById('h3').textContent=s3;
  const df = diffFactor();
  let win = 0;
  if(s1===s2 && s2===s3){ win = Math.floor(bet * (10 * df)); }
  else if(s1===s2 || s2===s3 || s1===s3){ win = Math.floor(bet * (2.2 * df)); }
  if(win>0){ award(win); setMsg('highMsg',`Win ${win}!`); state.pot = Math.max(0, state.pot - Math.floor(win/8)); saveState(); }
  else setMsg('highMsg','Tough luck.');
}));

document.getElementById('spinMega').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(20,Math.floor(Number(document.getElementById('betAmount').value)||20));
  if(!spend(bet)){ setMsg('megaMsg','Not enough chips'); return; }
  setMsg('megaMsg','Spinning...');
  for(let i=0;i<12;i++){
    document.getElementById('m1').textContent = pickSymbol();
    document.getElementById('m2').textContent = pickSymbol();
    document.getElementById('m3').textContent = pickSymbol();
    await new Promise(r=>setTimeout(r,60 + i*22));
  }
  const s1=pickSymbol(), s2=pickSymbol(), s3=pickSymbol();
  document.getElementById('m1').textContent=s1; document.getElementById('m2').textContent=s2; document.getElementById('m3').textContent=s3;
  const df = diffFactor();
  let win = 0;
  if(s1===s2 && s2===s3){ win = Math.floor(bet * (40 * df)); }
  else if(s1===s2 || s2===s3 || s1===s3){ win = Math.floor(bet * (3 * df)); }
  if(win>0){ award(win); setMsg('megaMsg',`Mega Win ${win}!`); state.pot = Math.max(0, state.pot - Math.floor(win/6)); saveState(); }
  else setMsg('megaMsg','Mega lost.');
}));

document.getElementById('spinDiamond').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(10,Math.floor(Number(document.getElementById('betAmount').value)||10));
  if(!spend(bet)){ setMsg('diamondMsg','Not enough chips'); return; }
  setMsg('diamondMsg','Spinning...');
  for(let i=0;i<10;i++){
    for(let j=1;j<=5;j++) document.getElementById('d'+j).textContent = pickSymbol();
    await new Promise(r=>setTimeout(r,50 + i*20));
  }
  const symbols = [];
  for(let j=1;j<=5;j++){ const s = pickSymbol(); document.getElementById('d'+j).textContent = s; symbols.push(s); }
  const df = diffFactor();
  const counts = {};
  symbols.forEach(s => counts[s] = (counts[s]||0)+1);
  const maxCount = Math.max(...Object.values(counts));
  let win = 0;
  if(maxCount === 5){ win = Math.floor(bet * (100 * df)); }
  else if(maxCount === 4){ win = Math.floor(bet * (20 * df)); }
  else if(maxCount === 3){ win = Math.floor(bet * (5 * df)); }
  if(win>0){ award(win); setMsg('diamondMsg',`${maxCount} match! +${win}`); state.pot = Math.max(0, state.pot - Math.floor(win/10)); saveState(); }
  else setMsg('diamondMsg','No match.');
}));

document.getElementById('spinLucky').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(5,Math.floor(Number(document.getElementById('betAmount').value)||5));
  if(!spend(bet)){ setMsg('luckyMsg','Not enough chips'); return; }
  setMsg('luckyMsg','Spinning...');
  for(let i=0;i<8;i++){
    document.getElementById('l1').textContent = pickSymbol();
    document.getElementById('l2').textContent = pickSymbol();
    document.getElementById('l3').textContent = pickSymbol();
    await new Promise(r=>setTimeout(r,60 + i*20));
  }
  const s1=pickSymbol(), s2=pickSymbol(), s3=pickSymbol();
  document.getElementById('l1').textContent=s1; document.getElementById('l2').textContent=s2; document.getElementById('l3').textContent=s3;
  const df = diffFactor();
  let win = 0;
  if(s1==='7Ô∏è‚É£' && s2==='7Ô∏è‚É£' && s3==='7Ô∏è‚É£'){ win = Math.floor(bet * (77 * df)); }
  else if(s1===s2 && s2===s3){ win = Math.floor(bet * (8 * df)); }
  else if(s1===s2 || s2===s3 || s1===s3){ win = Math.floor(bet * (2 * df)); }
  if(win>0){ award(win); setMsg('luckyMsg',`Lucky! +${win}`); state.pot = Math.max(0, state.pot - Math.floor(win/10)); saveState(); }
  else setMsg('luckyMsg','Try again!');
}));

/* COIN & DICE */
document.getElementById('coinFlip').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('coinMsg','Not enough chips'); return; }
  setMsg('coinMsg','Flipping...');
  await new Promise(r=>setTimeout(r,350));
  const df = diffFactor();
  const win = rngInt(100) < (50 * df) ? bet * 2 : 0;
  if(win>0){ award(win); setMsg('coinMsg',`Heads! +${win}`); document.getElementById('coinLast').textContent = `Win +${win}`;}
  else { setMsg('coinMsg','Tails.'); document.getElementById('coinLast').textContent = `Lose -${bet}`; }
}));

document.getElementById('rollHigh').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('diceMsg','Not enough chips'); return; }
  setMsg('diceMsg','Rolling...');
  await new Promise(r=>setTimeout(r,300));
  const roll = rngInt(6)+1;
  const df = diffFactor();
  if(roll >= 4 && rngInt(100) < 50*df){ const win = Math.floor(bet * (2*df)); award(win); setMsg('diceMsg',`Rolled ${roll}. You win ${win}`); }
  else setMsg('diceMsg',`Rolled ${roll}. You lost.`)
}));

document.getElementById('rollLow').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('diceMsg','Not enough chips'); return; }
  setMsg('diceMsg','Rolling...');
  await new Promise(r=>setTimeout(r,300));
  const roll = rngInt(6)+1;
  const df = diffFactor();
  if(roll <= 3 && rngInt(100) < 50*df){ const win = Math.floor(bet * (2*df)); award(win); setMsg('diceMsg',`Rolled ${roll}. You win ${win}`); }
  else setMsg('diceMsg',`Rolled ${roll}. You lost.`)
}));

document.getElementById('betAllIn').addEventListener('click', ()=> {
  const all = state.chips;
  document.getElementById('betAmount').value = all;
  setMsg('qbMsg','Bet set to all-in.');
});
document.getElementById('half').addEventListener('click', ()=> {
  document.getElementById('betAmount').value = Math.max(1,Math.floor(state.chips/2));
  setMsg('qbMsg','Bet set to half.');
});

/* WHEEL */
const wheelCanvas = document.getElementById('wheelCanvas');
const wctx = wheelCanvas.getContext('2d');
const wheelSlices = [];

function drawWheel(slices, angle=0){
  const cx = wheelCanvas.width/2, cy = wheelCanvas.height/2, r = Math.min(cx,cy)-10;
  wctx.clearRect(0,0,wheelCanvas.width,wheelCanvas.height);
  const n = slices.length;
  
  const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#eab308', '#ef4444', '#ffffff'];
  
  for(let i=0;i<n;i++){
    const a1 = (i/n)*Math.PI*2 + angle;
    const a2 = ((i+1)/n)*Math.PI*2 + angle;
    wctx.beginPath();
    wctx.moveTo(cx,cy);
    wctx.arc(cx,cy,r,a1,a2);
    wctx.closePath();
    
    let color = colors[i % colors.length];
    if(slices[i].type === 'lose') color = '#ef4444';
    else if(slices[i].type === 'win2') color = '#22c55e';
    else if(slices[i].type === 'win5') color = '#3b82f6';
    else if(slices[i].type === 'win10') color = '#8b5cf6';
    else if(slices[i].type === 'jackpot') color = '#eab308';
    else if(slices[i].type === 'bonus') color = '#ffffff';
    
    wctx.fillStyle = color;
    wctx.fill();
    wctx.strokeStyle = '#000';
    wctx.lineWidth = 2;
    wctx.stroke();
    
    wctx.save();
    wctx.translate(cx,cy);
    const mid = (a1+a2)/2;
    wctx.rotate(mid);
    wctx.fillStyle = '#000';
    wctx.font = 'bold 14px Inter';
    wctx.textAlign = 'right';
    wctx.fillText(slices[i].label, r-15, 5);
    wctx.restore();
  }
  
  wctx.beginPath(); 
  wctx.arc(cx,cy,40,0,Math.PI*2); 
  wctx.fillStyle='#0a0a0b'; 
  wctx.fill();
  wctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent');
  wctx.lineWidth = 3;
  wctx.stroke();
}

function buildWheel(){
  const diff = document.getElementById('difficulty').value;
  wheelSlices.length = 0;
  const entries = [];
  
  if(diff==='Easy'){
    entries.push(...Array(4).fill({label:'LOSE',type:'lose'}));
    entries.push(...Array(2).fill({label:'x2',type:'win2'}));
    entries.push({label:'x5',type:'win5'});
    entries.push({label:'x10',type:'win10'});
    entries.push({label:'JACKPOT',type:'jackpot'});
    entries.push({label:'BONUS',type:'bonus'});
  } else if(diff==='Medium'){
    entries.push(...Array(6).fill({label:'LOSE',type:'lose'}));
    entries.push({label:'x2',type:'win2'});
    entries.push({label:'x5',type:'win5'});
    entries.push({label:'x10',type:'win10'});
    entries.push({label:'JACKPOT',type:'jackpot'});
    entries.push({label:'BONUS',type:'bonus'});
  } else if(diff==='Hard'){
    entries.push(...Array(8).fill({label:'LOSE',type:'lose'}));
    entries.push({label:'x2',type:'win2'});
    entries.push({label:'x10',type:'win10'});
    entries.push({label:'JACKPOT',type:'jackpot'});
    entries.push({label:'BONUS',type:'bonus'});
  } else {
    entries.push(...Array(10).fill({label:'LOSE',type:'lose'}));
    entries.push({label:'x2',type:'win2'});
    entries.push({label:'JACKPOT',type:'jackpot'});
  }
  
  for(const e of entries) wheelSlices.push({...e});
  drawWheel(wheelSlices);
}

document.getElementById('difficulty').addEventListener('change', buildWheel);

document.getElementById('spinWheel').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('wheelMsg','Not enough chips'); return; }
  setMsg('wheelMsg','Spinning...');
  
  const slices = wheelSlices.slice();
  const rounds = 5 + rngInt(3);
  const targetIndex = rngInt(slices.length);
  const sliceAngle = (2*Math.PI)/slices.length;
  
  let lastAngle = 0;
  const totalSteps = 60;
  for(let i=0;i<totalSteps;i++){
    const t = i/totalSteps;
    const eased = 1 - Math.pow(1-t,3);
    lastAngle = (rounds*2*Math.PI + (targetIndex * sliceAngle) + sliceAngle/2) * (1 - eased);
    drawWheel(slices, lastAngle);
    await new Promise(r=>setTimeout(r,10 + Math.floor(i*2)));
  }
  drawWheel(slices, lastAngle);

  const res = slices[targetIndex];
  let resultText = '';
  if(res.type==='lose'){ resultText = 'LOSE'; setMsg('wheelMsg','You lost.'); }
  else if(res.type==='win2'){ const win=Math.floor(bet*2*diffFactor()); award(win); resultText=`WIN x2 +${win}`; setMsg('wheelMsg',`You won ${win}!`); }
  else if(res.type==='win5'){ const win=Math.floor(bet*5*diffFactor()); award(win); resultText=`WIN x5 +${win}`; setMsg('wheelMsg',`You won ${win}!`); }
  else if(res.type==='win10'){ const win=Math.floor(bet*10*diffFactor()); award(win); resultText=`WIN x10 +${win}`; setMsg('wheelMsg',`You won ${win}!`); }
  else if(res.type==='jackpot'){ const win=Math.floor(bet*50*diffFactor()); award(win); state.pot=0; saveState(); resultText=`JACKPOT +${win}`; setMsg('wheelMsg',`JACKPOT! ${win}!`); }
  else if(res.type==='bonus'){ resultText='BONUS SPIN!'; setMsg('wheelMsg','Bonus spin! Go again!'); award(bet); }
}));

function applyTheme() {
  const theme = localStorage.getItem('theme') || 'green';
  const colors = themeColors[theme] || themeColors.green;

  document.documentElement.style.setProperty('--accent', colors.primary);
  document.documentElement.style.setProperty('--accent-dim', colors.dim);

  const logo = document.getElementById('logo');
  if (logo) logo.src = `taclogos/${theme}.png`;

  if (sidebar) sidebar.style.boxShadow = `0 0 20px ${colors.shadow}`;
  
  if(typeof buildWheel === 'function') buildWheel();
}

window.addEventListener('storage', (e) => {
  if (e.key === 'theme') {
    applyTheme();
  }
});

/* BLACKJACK PVP - FIXED */
function makeDeck(){
  const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£']; const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const deck=[];
  for(const s of suits) for(const r of ranks) deck.push({suit:s,rank:r});
  return deck;
}

function shuffleDeck(d){ for(let i=d.length-1;i>0;i--){ const j=rngInt(i+1); [d[i],d[j]]=[d[j],d[i]]; } }

function handTotals(hand){
  if(!hand || !Array.isArray(hand)) return 0;
  let total=0, aces=0;
  for(const c of hand){ 
    if(!c || !c.rank) continue;
    const r = c.rank;
    if(r==='A'){ aces++; total += 11; }
    else if(['J','Q','K'].includes(r)) total += 10;
    else total += Number(r);
  }
  while(total>21 && aces>0){ total -= 10; aces--; }
  return total;
}

let bjCurrentRoom = null;
let bjMyRole = null;
let bjBetPaid = false;
let bjListener = null;
const username = localStorage.getItem('lastLoggedInUser') || 'Guest' + Math.floor(Math.random()*1000);

function cleanupBJRoom(){
  if(bjListener && bjCurrentRoom){
    database.ref('bj_rooms/' + bjCurrentRoom).off('value', bjListener);
    bjListener = null;
  }
  bjCurrentRoom = null;
  bjMyRole = null;
  bjBetPaid = false;
}

document.getElementById('bjCreateRoom').addEventListener('click', ()=> {
  cleanupBJRoom();
  const roomCode = 'BJ' + Math.floor(Math.random()*10000);
  const bet = Math.max(10, Number(document.getElementById('bjBetInput').value) || 50);
  
  bjCurrentRoom = roomCode;
  bjMyRole = 'dealer';
  document.getElementById('bjRoomCode').value = roomCode;
  document.getElementById('bjRoomInfo').textContent = `Room: ${roomCode} (You are Dealer) - Bet: ${bet}`;
  
  database.ref('bj_rooms/' + roomCode).set({
    host: username,
    bet: bet,
    players: {
      [username]: {chips: state.chips, ready: false, role: 'dealer', stood: false}
    },
    created: Date.now(),
    gameState: 'waiting',
    deck: [],
    hands: {},
    currentTurn: null
  });
  
  listenToBJRoom(roomCode);
  setMsg('bjMsg', 'Room created! Share code: ' + roomCode);
});

document.getElementById('bjJoinRoom').addEventListener('click', ()=> {
  const roomCode = document.getElementById('bjRoomCode').value.trim().toUpperCase();
  if(!roomCode){ setMsg('bjMsg', 'Enter room code'); return; }
  
  database.ref('bj_rooms/' + roomCode).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room){ setMsg('bjMsg', 'Room not found'); return; }
    
    const playerCount = Object.keys(room.players || {}).length;
    if(playerCount >= 2){ setMsg('bjMsg', 'Room full (2 players max)'); return; }
    if(room.gameState !== 'waiting'){ setMsg('bjMsg', 'Game already started'); return; }
    
    cleanupBJRoom();
    bjCurrentRoom = roomCode;
    bjMyRole = 'player';
    
    database.ref('bj_rooms/' + roomCode + '/players/' + username).set({
      chips: state.chips,
      ready: false,
      role: 'player',
      stood: false
    });
    
    document.getElementById('bjRoomInfo').textContent = `Room: ${roomCode} (You are Player) - Bet: ${room.bet}`;
    listenToBJRoom(roomCode);
    setMsg('bjMsg', 'Joined room! Click Ready when ready.');
  });
});

function listenToBJRoom(roomCode){
  bjListener = database.ref('bj_rooms/' + roomCode).on('value', (snapshot) => {
    const room = snapshot.val();
    if(!room) {
      setMsg('bjMsg', 'Room closed');
      cleanupBJRoom();
      return;
    }
    
    const playerList = document.getElementById('bjPlayerList');
    playerList.innerHTML = '';
    
    if(room.players){
      Object.keys(room.players).forEach(name => {
        const p = room.players[name];
        const div = document.createElement('div');
        div.className = 'player-item' + (p.ready ? ' ready' : '');
        const statusText = p.ready ? '‚úì Ready' : 'Not Ready';
        const stoodText = p.stood ? ' (Stood)' : '';
        div.innerHTML = `<span>${name} (${p.role})</span><span>${statusText}${stoodText}</span>`;
        playerList.appendChild(div);
      });
    }
    
    if(room.gameState === 'playing' && room.hands){
      renderBJFromRoom(room);
    }
    
    if(room.gameState === 'finished' && room.winner !== undefined){
      handleBJGameEnd(room);
    }
  });
}

function renderBJFromRoom(room){
  const pc = document.getElementById('bjPlayerCards');
  const dc = document.getElementById('bjDealerCards');
  pc.innerHTML = '';
  dc.innerHTML = '';
  
  const myHand = room.hands[username] || [];
  const opponentName = Object.keys(room.players).find(k => k !== username);
  const oppHand = opponentName ? (room.hands[opponentName] || []) : [];
  
  myHand.forEach(c => {
    const el = document.createElement('div');
    el.className = 'card-face';
    el.textContent = c.rank + c.suit;
    pc.appendChild(el);
  });
  
  const showOppCards = room.gameState === 'finished' || (room.players[opponentName] && room.players[opponentName].stood);
  oppHand.forEach((c, idx) => {
    const el = document.createElement('div');
    el.className = 'card-face';
    if(showOppCards || idx === 0){
      el.textContent = c.rank + c.suit;
    } else {
      el.textContent = 'üÇ†';
    }
    dc.appendChild(el);
  });
  
  document.getElementById('bjPlayerTotal').textContent = handTotals(myHand);
  document.getElementById('bjDealerTotal').textContent = showOppCards ? handTotals(oppHand) : '?';
  
  if(room.currentTurn === username){
    setMsg('bjMsg', 'Your turn! Hit or Stand.');
  } else if(room.currentTurn){
    setMsg('bjMsg', "Opponent's turn...");
  }
}

function handleBJGameEnd(room){
  if(!room.winnerProcessed){
    const totalPot = room.bet * 2;
    if(room.winner === username){
      award(totalPot);
      setMsg('bjMsg', `You win ${totalPot} chips!`);
    } else if(room.winner === 'push'){
      award(room.bet);
      setMsg('bjMsg', 'Push! Bet returned.');
    } else {
      setMsg('bjMsg', 'You lost!');
    }
    
    renderBJFromRoom(room);
    
    setTimeout(()=>{
      cleanupBJRoom();
      document.getElementById('bjRoomInfo').textContent = 'Not in a room';
      document.getElementById('bjPlayerList').innerHTML = '';
    }, 3000);
  }
}

document.getElementById('bjReady').addEventListener('click', ()=> {
  if(!bjCurrentRoom){ setMsg('bjMsg', 'Join a room first'); return; }
  
  database.ref('bj_rooms/' + bjCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room) return;
    
    if(room.gameState !== 'waiting'){
      setMsg('bjMsg', 'Game already started');
      return;
    }
    
    if(state.chips < room.bet){
      setMsg('bjMsg', 'Not enough chips for bet');
      return;
    }
    
    if(!bjBetPaid){
      spend(room.bet);
      bjBetPaid = true;
    }
    
    database.ref('bj_rooms/' + bjCurrentRoom + '/players/' + username).update({ready: true});
    
    setTimeout(()=>{
      database.ref('bj_rooms/' + bjCurrentRoom).once('value', (snap) => {
        const r = snap.val();
        if(!r || !r.players) return;
        
        const allReady = Object.values(r.players).every(p => p.ready);
        const playerCount = Object.keys(r.players).length;
        
        if(allReady && playerCount === 2 && r.gameState === 'waiting'){
          startBJGame(bjCurrentRoom, r);
        }
      });
    }, 500);
  });
});

function startBJGame(roomCode, room){
  const deck = makeDeck();
  shuffleDeck(deck);
  
  const playerNames = Object.keys(room.players);
  const hands = {};
  playerNames.forEach(name => {
    hands[name] = [deck.pop(), deck.pop()];
  });
  
  const playerRole = playerNames.find(n => room.players[n].role === 'player');
  
  database.ref('bj_rooms/' + roomCode).update({
    gameState: 'playing',
    deck: deck,
    hands: hands,
    currentTurn: playerRole
  });
}

document.getElementById('bjHit').addEventListener('click', ()=> {
  if(!bjCurrentRoom){ setMsg('bjMsg', 'Not in a game'); return; }
  
  database.ref('bj_rooms/' + bjCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room || room.gameState !== 'playing') return;
    if(room.currentTurn !== username){ setMsg('bjMsg', 'Not your turn'); return; }
    
    const deck = room.deck || [];
    if(deck.length === 0){ setMsg('bjMsg', 'No cards left'); return; }
    
    const newCard = deck.pop();
    const myHand = room.hands[username] || [];
    myHand.push(newCard);
    
    const updates = {
      deck: deck,
      [`hands/${username}`]: myHand
    };
    
    const total = handTotals(myHand);
    if(total > 21){
      const opponent = Object.keys(room.players).find(k => k !== username);
      updates.gameState = 'finished';
      updates.winner = opponent;
    }
    
    database.ref('bj_rooms/' + bjCurrentRoom).update(updates);
  });
});

document.getElementById('bjStand').addEventListener('click', ()=> {
  if(!bjCurrentRoom){ setMsg('bjMsg', 'Not in a game'); return; }
  
  database.ref('bj_rooms/' + bjCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room || room.gameState !== 'playing') return;
    if(room.currentTurn !== username){ setMsg('bjMsg', 'Not your turn'); return; }
    
    database.ref('bj_rooms/' + bjCurrentRoom + '/players/' + username).update({stood: true});
    
    const opponent = Object.keys(room.players).find(k => k !== username);
    const oppStood = room.players[opponent] && room.players[opponent].stood;
    
    if(oppStood){
      const myTotal = handTotals(room.hands[username]);
      const oppTotal = handTotals(room.hands[opponent]);
      
      let winner;
      if(myTotal > 21) winner = opponent;
      else if(oppTotal > 21) winner = username;
      else if(myTotal > oppTotal) winner = username;
      else if(oppTotal > myTotal) winner = opponent;
      else winner = 'push';
      
      database.ref('bj_rooms/' + bjCurrentRoom).update({
        gameState: 'finished',
        winner: winner,
        currentTurn: null
      });
    } else {
      database.ref('bj_rooms/' + bjCurrentRoom).update({
        currentTurn: opponent
      });
    }
  });
});

/* CHESS PVP - FIXED */
let chessCurrentRoom = null;
let chessMyColor = null;
let chessBoard = [];
let chessSelectedSquare = null;
let chessTurn = 'white';
let chessBetPaid = false;
let chessListener = null;

const CHESS_PIECES = {
  'white': {'K':'‚ôî','Q':'‚ôï','R':'‚ôñ','B':'‚ôó','N':'‚ôò','P':'‚ôô'},
  'black': {'K':'‚ôö','Q':'‚ôõ','R':'‚ôú','B':'‚ôù','N':'‚ôû','P':'‚ôü'}
};

function getInitialChessBoard(){
  return [
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    [null,null,null,null,null,null,null,null],
    [null,null,null,null,null,null,null,null],
    [null,null,null,null,null,null,null,null],
    [null,null,null,null,null,null,null,null],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R']
  ];
}

function cleanupChessRoom(){
  if(chessListener && chessCurrentRoom){
    database.ref('chess_rooms/' + chessCurrentRoom).off('value', chessListener);
    chessListener = null;
  }
  chessCurrentRoom = null;
  chessMyColor = null;
  chessBetPaid = false;
  chessSelectedSquare = null;
}

function renderChessBoard(){
  const boardDiv = document.getElementById('chessBoard');
  if(!boardDiv) return;
  boardDiv.innerHTML = '';
  
  if(!chessBoard || chessBoard.length !== 8) {
    chessBoard = getInitialChessBoard();
  }
  
  const isBlack = chessMyColor === 'black';
  
  for(let displayRow = 0; displayRow < 8; displayRow++){
    for(let displayCol = 0; displayCol < 8; displayCol++){
      const row = isBlack ? (7 - displayRow) : displayRow;
      const col = isBlack ? (7 - displayCol) : displayCol;
      
      const square = document.createElement('div');
      square.className = 'chess-square ' + ((row + col) % 2 === 0 ? 'white' : 'black');
      square.dataset.row = row;
      square.dataset.col = col;
      
      const piece = chessBoard[row] ? chessBoard[row][col] : null;
      if(piece){
        const isUpperCase = piece === piece.toUpperCase();
        const color = isUpperCase ? 'white' : 'black';
        const pieceKey = piece.toUpperCase();
        if(CHESS_PIECES[color] && CHESS_PIECES[color][pieceKey]){
          square.textContent = CHESS_PIECES[color][pieceKey];
        }
      }
      
      if(chessSelectedSquare && chessSelectedSquare.row === row && chessSelectedSquare.col === col){
        square.classList.add('selected');
      }
      
      square.addEventListener('click', () => handleChessClick(row, col));
      boardDiv.appendChild(square);
    }
  }
}

function getPieceColor(piece){
  if(!piece) return null;
  return piece === piece.toUpperCase() ? 'white' : 'black';
}

function isValidChessMove(board, fromRow, fromCol, toRow, toCol){
  const piece = board[fromRow][fromCol];
  if(!piece) return false;
  
  const targetPiece = board[toRow][toCol];
  const pieceColor = getPieceColor(piece);
  const targetColor = getPieceColor(targetPiece);
  
  if(targetColor === pieceColor) return false;
  
  const pieceType = piece.toUpperCase();
  const rowDiff = toRow - fromRow;
  const colDiff = toCol - fromCol;
  const absRowDiff = Math.abs(rowDiff);
  const absColDiff = Math.abs(colDiff);
  
  switch(pieceType){
    case 'P':
      const direction = pieceColor === 'white' ? -1 : 1;
      const startRow = pieceColor === 'white' ? 6 : 1;
      
      if(colDiff === 0 && !targetPiece){
        if(rowDiff === direction) return true;
        if(fromRow === startRow && rowDiff === 2 * direction && !board[fromRow + direction][fromCol]) return true;
      }
      if(absColDiff === 1 && rowDiff === direction && targetPiece) return true;
      return false;
      
    case 'R':
      if(rowDiff !== 0 && colDiff !== 0) return false;
      return isPathClear(board, fromRow, fromCol, toRow, toCol);
      
    case 'N':
      return (absRowDiff === 2 && absColDiff === 1) || (absRowDiff === 1 && absColDiff === 2);
      
    case 'B':
      if(absRowDiff !== absColDiff) return false;
      return isPathClear(board, fromRow, fromCol, toRow, toCol);
      
    case 'Q':
      if(rowDiff !== 0 && colDiff !== 0 && absRowDiff !== absColDiff) return false;
      return isPathClear(board, fromRow, fromCol, toRow, toCol);
      
    case 'K':
      return absRowDiff <= 1 && absColDiff <= 1;
      
    default:
      return false;
  }
}

function isPathClear(board, fromRow, fromCol, toRow, toCol){
  const rowDir = toRow > fromRow ? 1 : (toRow < fromRow ? -1 : 0);
  const colDir = toCol > fromCol ? 1 : (toCol < fromCol ? -1 : 0);
  
  let r = fromRow + rowDir;
  let c = fromCol + colDir;
  
  while(r !== toRow || c !== toCol){
    if(board[r][c]) return false;
    r += rowDir;
    c += colDir;
  }
  return true;
}

function handleChessClick(row, col){
  if(!chessCurrentRoom){ 
    setMsg('chessMsg', 'Join a room first'); 
    return; 
  }
  
  database.ref('chess_rooms/' + chessCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room || room.gameState !== 'playing'){
      setMsg('chessMsg', 'Game not started');
      return;
    }
    
    if(room.turn !== chessMyColor){ 
      setMsg('chessMsg', 'Not your turn'); 
      return; 
    }
    
    const currentBoard = room.board || getInitialChessBoard();
    
    if(chessSelectedSquare){
      const fromRow = chessSelectedSquare.row;
      const fromCol = chessSelectedSquare.col;
      const piece = currentBoard[fromRow][fromCol];
      
      if(piece && isValidChessMove(currentBoard, fromRow, fromCol, row, col)){
        const capturedPiece = currentBoard[row][col];
        currentBoard[row][col] = currentBoard[fromRow][fromCol];
        currentBoard[fromRow][fromCol] = null;
        
        const isKingCapture = capturedPiece && capturedPiece.toUpperCase() === 'K';
        const nextTurn = room.turn === 'white' ? 'black' : 'white';
        
        const updates = {
          board: currentBoard,
          turn: nextTurn
        };
        
        if(isKingCapture){
          updates.gameState = 'finished';
          updates.winner = username;
        }
        
        database.ref('chess_rooms/' + chessCurrentRoom).update(updates);
        setMsg('chessMsg', 'Move made!');
      }
      
      chessSelectedSquare = null;
      chessBoard = currentBoard;
      renderChessBoard();
    } else {
      const piece = currentBoard[row][col];
      if(piece){
        const pieceColor = getPieceColor(piece);
        if(pieceColor === chessMyColor){
          chessSelectedSquare = {row, col};
          chessBoard = currentBoard;
          renderChessBoard();
        }
      }
    }
  });
}

document.getElementById('chessCreateRoom').addEventListener('click', ()=> {
  cleanupChessRoom();
  const roomCode = 'CHESS' + Math.floor(Math.random()*10000);
  const bet = Math.max(10, Number(document.getElementById('chessBetInput').value) || 50);
  
  chessCurrentRoom = roomCode;
  chessMyColor = 'white';
  chessBoard = getInitialChessBoard();
  
  document.getElementById('chessRoomCode').value = roomCode;
  document.getElementById('chessRoomInfo').textContent = `Room: ${roomCode} (You are White) - Bet: ${bet}`;
  
  database.ref('chess_rooms/' + roomCode).set({
    host: username,
    bet: bet,
    players: {
      [username]: {chips: state.chips, ready: false, color: 'white'}
    },
    created: Date.now(),
    gameState: 'waiting',
    board: chessBoard,
    turn: 'white'
  });
  
  renderChessBoard();
  listenToChessRoom(roomCode);
  setMsg('chessMsg', 'Room created! Share code: ' + roomCode);
});

document.getElementById('chessJoinRoom').addEventListener('click', ()=> {
  const roomCode = document.getElementById('chessRoomCode').value.trim().toUpperCase();
  if(!roomCode){ setMsg('chessMsg', 'Enter room code'); return; }
  
  database.ref('chess_rooms/' + roomCode).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room){ setMsg('chessMsg', 'Room not found'); return; }
    
    const playerCount = Object.keys(room.players || {}).length;
    if(playerCount >= 2){ setMsg('chessMsg', 'Room full'); return; }
    if(room.gameState !== 'waiting'){ setMsg('chessMsg', 'Game already started'); return; }
    
    cleanupChessRoom();
    chessCurrentRoom = roomCode;
    chessMyColor = 'black';
    chessBoard = room.board || getInitialChessBoard();
    
    database.ref('chess_rooms/' + roomCode + '/players/' + username).set({
      chips: state.chips,
      ready: false,
      color: 'black'
    });
    
    document.getElementById('chessRoomInfo').textContent = `Room: ${roomCode} (You are Black) - Bet: ${room.bet}`;
    renderChessBoard();
    listenToChessRoom(roomCode);
    setMsg('chessMsg', 'Joined! Click Ready to start.');
  });
});

function listenToChessRoom(roomCode){
  chessListener = database.ref('chess_rooms/' + roomCode).on('value', (snapshot) => {
    const room = snapshot.val();
    if(!room) {
      setMsg('chessMsg', 'Room closed');
      cleanupChessRoom();
      document.getElementById('chessRoomInfo').textContent = 'Not in a room';
      document.getElementById('chessPlayerList').innerHTML = '';
      return;
    }
    
    const playerList = document.getElementById('chessPlayerList');
    playerList.innerHTML = '';
    
    if(room.players){
      Object.keys(room.players).forEach(name => {
        const p = room.players[name];
        const div = document.createElement('div');
        div.className = 'player-item' + (p.ready ? ' ready' : '');
        div.innerHTML = `<span>${name} (${p.color})</span><span>${p.ready ? '‚úì Ready' : 'Not Ready'}</span>`;
        playerList.appendChild(div);
      });
    }
    
    if(room.board){
      chessBoard = room.board;
      renderChessBoard();
    }
    
    if(room.turn){
      chessTurn = room.turn;
      if(room.gameState === 'playing'){
        if(chessTurn === chessMyColor){
          setMsg('chessMsg', 'Your turn!');
        } else {
          setMsg('chessMsg', "Opponent's turn...");
        }
      }
    }
    
    if(room.gameState === 'finished' && room.winner){
      const totalPot = room.bet * 2;
      if(room.winner === username){
        award(totalPot);
        setMsg('chessMsg', `You win ${totalPot} chips!`);
      } else {
        setMsg('chessMsg', 'You lost!');
      }
      
      setTimeout(()=>{
        cleanupChessRoom();
        document.getElementById('chessRoomInfo').textContent = 'Not in a room';
        document.getElementById('chessPlayerList').innerHTML = '';
        chessBoard = getInitialChessBoard();
        renderChessBoard();
      }, 3000);
    }
  });
}

document.getElementById('chessReady').addEventListener('click', ()=> {
  if(!chessCurrentRoom){ setMsg('chessMsg', 'Join room first'); return; }
  
  database.ref('chess_rooms/' + chessCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room) return;
    
    if(room.gameState !== 'waiting'){
      setMsg('chessMsg', 'Game already started');
      return;
    }
    
    if(state.chips < room.bet){
      setMsg('chessMsg', 'Not enough chips');
      return;
    }
    
    if(!chessBetPaid){
      spend(room.bet);
      chessBetPaid = true;
    }
    
    database.ref('chess_rooms/' + chessCurrentRoom + '/players/' + username).update({ready: true});
    
    setTimeout(()=>{
      database.ref('chess_rooms/' + chessCurrentRoom).once('value', (snap) => {
        const r = snap.val();
        if(!r || !r.players) return;
        
        const allReady = Object.values(r.players).every(p => p.ready);
        const playerCount = Object.keys(r.players).length;
        
        if(allReady && playerCount === 2 && r.gameState === 'waiting'){
          database.ref('chess_rooms/' + chessCurrentRoom).update({
            gameState: 'playing'
          });
          setMsg('chessMsg', 'Game started! White moves first.');
        }
      });
    }, 500);
  });
});

document.getElementById('chessResign').addEventListener('click', ()=> {
  if(!chessCurrentRoom){ setMsg('chessMsg', 'Not in game'); return; }
  
  database.ref('chess_rooms/' + chessCurrentRoom).once('value', (snapshot) => {
    const room = snapshot.val();
    if(!room || room.gameState !== 'playing') return;
    
    const opponent = Object.keys(room.players).find(k => k !== username);
    
    database.ref('chess_rooms/' + chessCurrentRoom).update({
      winner: opponent,
      gameState: 'finished'
    });
    
    setMsg('chessMsg', 'You resigned.');
  });
});

/* ROULETTE */
const redSet = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
document.getElementById('betRed').addEventListener('click', ()=> rouletteBet('red'));
document.getElementById('betBlack').addEventListener('click', ()=> rouletteBet('black'));
document.getElementById('betEven').addEventListener('click', ()=> rouletteBet('even'));
document.getElementById('betOdd').addEventListener('click', ()=> rouletteBet('odd'));
document.getElementById('betNumber').addEventListener('click', ()=> rouletteBet('number'));

function rouletteBet(type){
  actionWithCooldown(async ()=>{
    const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
    if(!spend(bet)){ setMsg('rouletteMsg','Not enough chips'); return; }
    setMsg('rouletteMsg','Spinning...');
    await new Promise(r=>setTimeout(r,400));
    const num = rngInt(37);
    let win = 0;
    if(type==='red' && redSet.has(num)) win = Math.floor(bet * 2 * diffFactor());
    if(type==='black' && !redSet.has(num) && num!==0) win = Math.floor(bet * 2 * diffFactor());
    if(type==='even' && num!==0 && num%2===0) win = Math.floor(bet * 2 * diffFactor());
    if(type==='odd' && num%2===1) win = Math.floor(bet * 2 * diffFactor());
    if(type==='number'){ const pick = Math.max(0,Math.min(36,Math.floor(Number(document.getElementById('rouletteNumber').value)||0))); if(pick===num) win = Math.floor(bet * 36 * diffFactor()); }
    if(win>0){ award(win); setMsg('rouletteMsg',`Number ${num}. Win ${win}!`); state.pot = Math.max(0,state.pot - Math.floor(win/10)); saveState(); }
    else setMsg('rouletteMsg',`Number ${num}. Lost.`);
  });
}

/* HORSE RACING */
function buildHorses(){
  const select = document.getElementById('horsePick'); select.innerHTML='';
  const diff = document.getElementById('difficulty').value;
  
  const baseOdds = diff==='Easy' ? [2,3,3,4,5,6] : 
                   diff==='Medium' ? [3,4,4,5,6,8] : 
                   diff==='Hard' ? [4,5,6,7,9,12] : 
                   [5,7,9,11,15,20];
  
  for(let i=0;i<6;i++){
    const opt = document.createElement('option'); 
    opt.value = i; 
    opt.textContent = `#${i+1} ‚Äî ${baseOdds[i]}:1`;
    opt.dataset.odds = baseOdds[i];
    select.appendChild(opt);
  }
  
  const track = document.getElementById('track'); track.innerHTML='';
  for(let i=0;i<6;i++){
    const h = document.createElement('div'); 
    h.className='horse'; 
    h.style.top = `${8 + i*18}px`;
    h.style.left = '8px';
    h.innerHTML = `<div style="background:var(--accent);padding:4px 8px;border-radius:6px;font-weight:800;color:#042">#${i+1}</div><div class="small">${baseOdds[i]}:1</div>`;
    track.appendChild(h);
  }
}

buildHorses();
document.getElementById('difficulty').addEventListener('change', buildHorses);

document.getElementById('startRace').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  const pickIdx = Number(document.getElementById('horsePick').value||0);
  const mode = document.getElementById('raceMode').value;
  if(!spend(bet)){ setMsg('horseMsg','Not enough chips'); return; }
  setMsg('horseMsg',`Starting race...`);
  
  const track = document.getElementById('track');
  const horses = Array.from(track.children);
  const odds = Array.from(document.getElementById('horsePick').options).map(o=>Number(o.dataset.odds));
  
  const HORSE_WIDTH = 100;
  let distanceFactor = mode==='sprint' ? 0.6 : mode==='long' ? 1.4 : 1.0;
  const finishPx = track.clientWidth * distanceFactor - HORSE_WIDTH;
  
  const speeds = horses.map((h,i)=> {
    const baseSpeed = 1 / odds[i];
    const randomness = 0.7 + (Math.random() * 0.6);
    const luckFactor = Math.random() > 0.8 ? 1.3 : 1.0;
    return baseSpeed * randomness * luckFactor;
  });
  
  let finished=false; let winner=-1;
  const positions = horses.map(()=>8);

  while(!finished){
    for(let i=0;i<horses.length;i++){
      const el = horses[i];
      const inc = 1 + speeds[i]*4 + (Math.random() * 2);
      const newLeft = Math.min(finishPx, positions[i] + inc);
      positions[i] = newLeft;
      el.style.left = newLeft + 'px';
      
      if(newLeft >= finishPx && !finished){ finished=true; winner=i; break; }
    }
    await new Promise(r=>setTimeout(r,40));
  }

  const pickOdds = Number(document.getElementById('horsePick').options[pickIdx].dataset.odds);
  if(winner===pickIdx){ 
    const win = Math.floor(bet * pickOdds * diffFactor()); 
    award(win); 
    setMsg('horseMsg',`Horse #${winner+1} wins! You get ${win}`); 
    state.pot = Math.max(0,state.pot - Math.floor(win/5)); saveState(); 
  }
  else setMsg('horseMsg',`Horse #${winner+1} wins. You lost.`);

  setTimeout(()=>{ for(const h of horses) h.style.left='8px'; }, 1200);
}));

/* TEXAS HOLDEM */
function deckAll(){ return makeDeck(); }
function drawCard(d){ return d.pop(); }

function rankHand(cards){
  const vals = cards.map(c=>{ if(c.rank==='A') return 14; if(c.rank==='K') return 13; if(c.rank==='Q') return 12; if(c.rank==='J') return 11; return Number(c.rank); });
  vals.sort((a,b)=>b-a);
  const counts = {}; for(const v of vals) counts[v]=(counts[v]||0)+1;
  const countValues = Object.values(counts).sort((a,b)=>b-a);
  const suits = {};
  for(const c of cards) suits[c.suit]=(suits[c.suit]||0)+1;
  const isFlush = Object.values(suits).some(v=>v>=5);
  const unique = Array.from(new Set(vals)).sort((a,b)=>a-b);
  let straight=false;
  for(let i=0;i<=unique.length-5;i++){ 
    if(unique[i]+1===unique[i+1] && unique[i]+2===unique[i+2] && unique[i]+3===unique[i+3] && unique[i]+4===unique[i+4]) straight=true; 
  }
  const high = vals[0];
  if(countValues[0]===4) return [8000 + high, 'Four of a Kind'];
  if(countValues[0]===3 && countValues[1]===2) return [7000 + high, 'Full House'];
  if(isFlush) return [6000 + high, 'Flush'];
  if(straight) return [5000 + high, 'Straight'];
  if(countValues[0]===3) return [4000 + high, 'Three of a Kind'];
  if(countValues[0]===2 && countValues[1]===2) return [3000 + high, 'Two Pair'];
  if(countValues[0]===2) return [2000 + high, 'One Pair'];
  return [high, 'High Card'];
}

let thDeck=[], thPlayer=[], thAI=[], thCommunity=[], thStage=0;

document.getElementById('thDeal').addEventListener('click', ()=> {
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('thMsg','Not enough chips'); return; }
  thDeck = deckAll(); shuffleDeck(thDeck);
  thPlayer = [drawCard(thDeck), drawCard(thDeck)];
  thAI = [drawCard(thDeck), drawCard(thDeck)];
  thCommunity = []; thStage=1; renderTH(); setMsg('thMsg','Preflop. Next Stage.');
});

document.getElementById('thNext').addEventListener('click', ()=> actionWithCooldown(async ()=>{
  if(!thDeck.length) { setMsg('thMsg','Deal first'); return; }
  if(thStage===1){ 
    thCommunity.push(drawCard(thDeck), drawCard(thDeck), drawCard(thDeck)); 
    thStage=2; renderTH(); setMsg('thMsg','Flop.'); return;
  }
  if(thStage===2){ 
    thCommunity.push(drawCard(thDeck)); 
    thStage=3; renderTH(); setMsg('thMsg','Turn.'); return; 
  }
  if(thStage===3){ 
    thCommunity.push(drawCard(thDeck)); 
    thStage=4; renderTH();
    const playerBest = rankHand(thPlayer.concat(thCommunity));
    const aiBest = rankHand(thAI.concat(thCommunity));
    const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
    if(playerBest[0] > aiBest[0]){ 
      const win = Math.floor(bet*4*diffFactor()); 
      award(win); 
      setMsg('thMsg',`You win (${playerBest[1]} > ${aiBest[1]}). +${win}`); 
      state.pot = Math.max(0,state.pot - Math.floor(win/5)); saveState(); 
    }
    else if(playerBest[0] === aiBest[0]) setMsg('thMsg',`Push (${playerBest[1]}).`);
    else setMsg('thMsg',`AI wins (${aiBest[1]} > ${playerBest[1]}).`);
    thStage=0; return;
  }
}));

function renderTH(){
  const ph = document.getElementById('thPlayerCards'); const ch = document.getElementById('thCommunity');
  ph.innerHTML=''; ch.innerHTML='';
  for(const c of thPlayer){ const e=document.createElement('div'); e.className='card-face'; e.textContent = c.rank + c.suit; ph.appendChild(e); }
  for(const c of thCommunity){ const e=document.createElement('div'); e.className='card-face'; e.textContent = c.rank + c.suit; ch.appendChild(e); }
}

/* 5-CARD POKER */
let pDeck=[], pPlayer=[], pDealer=[];

document.getElementById('pokerDeal').addEventListener('click', ()=> {
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('pokerMsg','Not enough chips'); return; }
  pDeck = makeDeck(); shuffleDeck(pDeck);
  pPlayer = [pDeck.pop(),pDeck.pop(),pDeck.pop(),pDeck.pop(),pDeck.pop()];
  pDealer = [pDeck.pop(),pDeck.pop(),pDeck.pop(),pDeck.pop(),pDeck.pop()];
  renderPoker();
  setMsg('pokerMsg','Select cards then Draw.');
});

document.getElementById('pokerDraw').addEventListener('click', ()=> {
  const slots = document.querySelectorAll('#pokerPlayer .card-face');
  const toReplace = [];
  slots.forEach((el,i)=>{ if(el.classList.contains('selected')) toReplace.push(i); });
  for(const idx of toReplace){ pPlayer[idx] = pDeck.pop(); }
  renderPoker();
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  const playerRank = rankHand(pPlayer)[0]; const dealerRank = rankHand(pDealer)[0];
  if(playerRank > dealerRank){ 
    const win = Math.floor(bet*3*diffFactor()); 
    award(win); 
    setMsg('pokerMsg',`You win! +${win}`); 
    state.pot = Math.max(0,state.pot - Math.floor(win/6)); saveState(); 
  }
  else if(playerRank===dealerRank){ setMsg('pokerMsg','Push.'); award(bet); }
  else setMsg('pokerMsg','Dealer wins.');
});

function renderPoker(){
  const wrap = document.getElementById('pokerPlayer'); wrap.innerHTML='';
  pPlayer.forEach((c,i)=>{ 
    const e=document.createElement('div'); 
    e.className='card-face'; 
    e.textContent = c.rank + c.suit; 
    e.addEventListener('click', ()=> e.classList.toggle('selected')); 
    wrap.appendChild(e); 
  });
}

/* CRASH GAME */
let crashInterval = null;
let crashMultiplier = 1.0;
let crashBet = 0;
let crashActive = false;

document.getElementById('crashStart').addEventListener('click', ()=> {
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('crashMsg','Not enough chips'); return; }
  crashBet = bet;
  crashMultiplier = 1.0;
  crashActive = true;
  
  const crashPoint = 1.0 + (Math.random() * 10);
  
  setMsg('crashMsg','Game running! Cash out anytime!');
  
  crashInterval = setInterval(()=> {
    crashMultiplier += 0.05 + (Math.random() * 0.1);
    document.getElementById('crashMultiplier').textContent = crashMultiplier.toFixed(2) + 'x';
    
    if(crashMultiplier >= crashPoint){
      clearInterval(crashInterval);
      crashActive = false;
      document.getElementById('crashMultiplier').textContent = 'CRASHED!';
      setMsg('crashMsg',`Crashed at ${crashPoint.toFixed(2)}x. You lost ${crashBet} chips.`);
      crashBet = 0;
    }
  }, 100);
});

document.getElementById('crashCashout').addEventListener('click', ()=> {
  if(!crashActive){ setMsg('crashMsg','Start game first'); return; }
  
  clearInterval(crashInterval);
  crashActive = false;
  
  const win = Math.floor(crashBet * crashMultiplier);
  award(win);
  setMsg('crashMsg',`Cashed out at ${crashMultiplier.toFixed(2)}x! Won ${win} chips!`);
  document.getElementById('crashMultiplier').textContent = crashMultiplier.toFixed(2) + 'x';
  crashBet = 0;
});

/* HI-LO CARD GAME */
let hiloCurrentCard = null;
let hiloStreak = 0;
let hiloMultiplier = 1.0;

function getCardValue(card){
  if(!card) return 0;
  if(card.rank === 'A') return 1;
  if(card.rank === 'J') return 11;
  if(card.rank === 'Q') return 12;
  if(card.rank === 'K') return 13;
  return Number(card.rank);
}

document.getElementById('hiloStart').addEventListener('click', ()=> {
  const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
  if(!spend(bet)){ setMsg('hiloMsg','Not enough chips'); return; }
  
  const deck = makeDeck();
  shuffleDeck(deck);
  hiloCurrentCard = deck.pop();
  hiloStreak = 0;
  hiloMultiplier = 1.0;
  
  document.getElementById('hiloCard').textContent = hiloCurrentCard.rank + hiloCurrentCard.suit;
  document.getElementById('hiloValue').textContent = getCardValue(hiloCurrentCard);
  document.getElementById('hiloStreak').textContent = hiloStreak;
  document.getElementById('hiloMult').textContent = hiloMultiplier.toFixed(1) + 'x';
  
  setMsg('hiloMsg','Guess higher or lower!');
});

function hiloGuess(guess){
  if(!hiloCurrentCard){ setMsg('hiloMsg','Start game first'); return; }
  
  const deck = makeDeck();
  shuffleDeck(deck);
  const nextCard = deck.pop();
  
  const currentVal = getCardValue(hiloCurrentCard);
  const nextVal = getCardValue(nextCard);
  
  let correct = false;
  if(guess === 'higher' && nextVal > currentVal) correct = true;
  if(guess === 'lower' && nextVal < currentVal) correct = true;
  
  document.getElementById('hiloCard').textContent = nextCard.rank + nextCard.suit;
  document.getElementById('hiloValue').textContent = nextVal;
  
  if(correct){
    hiloStreak++;
    hiloMultiplier += 0.5;
    document.getElementById('hiloStreak').textContent = hiloStreak;
    document.getElementById('hiloMult').textContent = hiloMultiplier.toFixed(1) + 'x';
    setMsg('hiloMsg',`Correct! Streak: ${hiloStreak}`);
    
    const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
    const win = Math.floor(bet * hiloMultiplier * diffFactor());
    award(win);
    
    hiloCurrentCard = nextCard;
  } else {
    setMsg('hiloMsg',`Wrong! Lost streak of ${hiloStreak}.`);
    hiloCurrentCard = null;
    hiloStreak = 0;
    hiloMultiplier = 1.0;
    document.getElementById('hiloStreak').textContent = '0';
    document.getElementById('hiloMult').textContent = '1.0x';
  }
}

document.getElementById('hiloHigher').addEventListener('click', ()=> hiloGuess('higher'));
document.getElementById('hiloLower').addEventListener('click', ()=> hiloGuess('lower'));

/* SPORTS BETTING */
document.querySelectorAll('#sports button[data-sport]').forEach(btn => {
  btn.addEventListener('click', ()=> sportsBet(btn.dataset.sport, btn.dataset.team, Number(btn.dataset.odds)));
});

function sportsBet(sport, team, odds){
  actionWithCooldown(async ()=>{
    const bet = Math.max(1,Math.floor(Number(document.getElementById('betAmount').value)||1));
    if(!spend(bet)){ setMsg('sportsMsg','Not enough chips'); return; }

    setMsg('sportsMsg',`Betting ${bet} on ${team}...`);
    await new Promise(r=>setTimeout(r,800));

    const df = diffFactor();
    let baseWinChance = 1 / odds;
    let finalWinChance = baseWinChance * df;
    if(finalWinChance > 0.9) finalWinChance = 0.9;
    if(finalWinChance < 0.1) finalWinChance = 0.1;
    
    const isWin = Math.random() < finalWinChance;

    if(isWin){
      const winMult = odds * df;
      const win = Math.floor(bet * winMult);
      award(win);
      setMsg('sportsMsg', `${team} wins! You won ${win} chips! (${winMult.toFixed(2)}x)`);
      state.pot = Math.max(0, state.pot - Math.floor(win/10)); saveState();
    } else {
      setMsg('sportsMsg', `${team} lost. You lost ${bet} chips.`);
    }
  });
}

/* INIT */
loadState();
buildWheel();
chessBoard = getInitialChessBoard();
renderChessBoard();
applyTheme();
setInterval(()=>{ updateUI(); }, 1200);
</script>
<script src="guard.js"></script>
    <script src="custom-cursor.js"></script>
    <script src="rightclick.js"></script>
    <script src="panic-key.js"></script>
    <script src="idle-dvd.js"></script>
</body>
</html>