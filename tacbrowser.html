<!DOCTYPE html>
<html lang="en">
<head>
<script src="guard.js"></script>
    <link rel="stylesheet" href="rightclick.css">
    <link rel="stylesheet" href="custom-cursor.css">
    <link rel="stylesheet" href__="rightclick.css">
    <link rel="stylesheet" href__="custom-cursor.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAC - Browser</title>

    <style>
        :root {
            --bg: #0a0a0b;
            --panel: #111113;
            --panel-hover: #1a1a1c;
            --accent: #22c55e;
            --accent-dim: rgba(34, 197, 94, 0.1);
            --muted: #71717a;
            --border: rgba(255,255,255,0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: #fff;
            font-size: 14px;
            overflow: hidden;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 70px;
            background: var(--panel);
            border: 1px solid var(--accent);
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 0;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 0 20px var(--accent-dim);
        }

        .sidebar.collapsed {
            width: 0;
            padding: 0;
            border: none;
            margin-left: -10px;
            overflow: hidden;
        }

        .logo-container {
            margin-bottom: 16px;
            padding: 4px;
            transition: opacity 0.3s;
        }

        .sidebar.collapsed .logo-container {
            opacity: 0;
        }

        .logo {
            width: 62px;
            height: 62px;
            border-radius: 8px;
        }

        .nav-items {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            width: 100%;
            padding: 0 8px;
            transition: opacity 0.3s;
        }

        .sidebar.collapsed .nav-items {
            opacity: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 54px;
            height: 54px;
            border-radius: 10px;
            text-decoration: none;
            color: var(--accent);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--accent-dim);
        }

        .nav-item.active {
            background: var(--accent-dim);
            border: 1px solid var(--accent);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }

        .nav-item span {
            font-size: 9px;
            font-weight: 500;
        }

        .toggle-btn {
            position: fixed;
            left: 90px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 36px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .toggle-btn:hover {
            background: var(--panel-hover);
            border-color: var(--accent);
        }

        .toggle-btn svg {
            width: 14px;
            height: 14px;
            color: #fff;
            transition: transform 0.3s ease;
        }

        .toggle-btn.collapsed {
            left: 10px;
        }

        .toggle-btn.collapsed svg {
            transform: rotate(180deg);
        }

        /* Main Content */
        .main-content {
            margin-left: 100px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 24px;
        }

        /* Browser Controls */
        .browser-toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
        }

        .nav-buttons {
            display: flex;
            gap: 4px;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: var(--accent-dim);
            border-color: var(--accent);
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nav-btn svg {
            width: 18px;
            height: 18px;
        }

        .url-container {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .url-input {
            flex: 1;
            height: 36px;
            padding: 0 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: #fff;
            font-size: 13px;
            outline: none;
            transition: all 0.2s ease;
        }

        .url-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-dim);
        }

        .url-input::placeholder {
            color: var(--muted);
        }

        .go-btn {
            height: 36px;
            padding: 0 20px;
            border-radius: 8px;
            border: 1px solid var(--accent);
            background: var(--accent-dim);
            color: var(--accent);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .go-btn:hover {
            background: var(--accent);
            color: #000;
        }

        /* ===== TAB BAR ===== */
        .tab-bar {
            display: flex;
            align-items: center;
            background: var(--panel);
            border-bottom: 1px solid var(--border);
            padding: 0 8px;
            height: 38px;
            gap: 2px;
            overflow-x: auto;
            flex-shrink: 0;
        }

        .tab-bar::-webkit-scrollbar {
            height: 0;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 8px;
            height: 30px;
            padding: 0 12px;
            border-radius: 8px 8px 0 0;
            background: transparent;
            border: 1px solid transparent;
            border-bottom: none;
            color: var(--muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            white-space: nowrap;
            max-width: 200px;
            min-width: 80px;
            position: relative;
            flex-shrink: 0;
        }

        .tab:hover {
            background: var(--panel-hover);
            color: #fff;
        }

        .tab.active {
            background: var(--bg);
            border-color: var(--border);
            color: #fff;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent);
            border-radius: 2px 2px 0 0;
        }

        .tab-title {
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            pointer-events: none;
        }

        .tab-close {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--muted);
            cursor: pointer;
            transition: all 0.15s ease;
            flex-shrink: 0;
            padding: 0;
            line-height: 1;
        }

        .tab-close:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .tab-close svg {
            width: 12px;
            height: 12px;
        }

        .new-tab-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid transparent;
            color: var(--muted);
            cursor: pointer;
            transition: all 0.15s ease;
            flex-shrink: 0;
            margin-left: 4px;
        }

        .new-tab-btn:hover {
            background: var(--accent-dim);
            border-color: var(--accent);
            color: var(--accent);
        }

        .new-tab-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Browser Frame */
        .browser-frame {
            flex: 1;
            position: relative;
            background: var(--bg);
        }

        .browser-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #fff;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Error Overlay */
        .error-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
            text-align: center;
            padding: 40px;
            z-index: 10;
        }

        .error-overlay.visible {
            display: flex;
        }

        .error-overlay svg {
            width: 64px;
            height: 64px;
            color: var(--accent);
            opacity: 0.6;
        }

        .error-overlay h2 {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
        }

        .error-overlay p {
            font-size: 14px;
            color: var(--muted);
            max-width: 400px;
            line-height: 1.6;
        }

        .open-blank-btn {
            padding: 12px 28px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            background: var(--accent);
            color: #000;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .open-blank-btn:hover {
            background: transparent;
            color: var(--accent);
        }

        /* Loading indicator */
        .loading-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 3px;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
            z-index: 100;
        }

        .loading-bar.active {
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { width: 0%; left: 0; }
            50% { width: 60%; left: 20%; }
            100% { width: 0%; left: 100%; }
        }

        /* Welcome Screen */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
            text-align: center;
            z-index: 5;
        }

        .welcome-screen h1 {
            font-size: 28px;
            font-weight: 700;
            color: #fff;
        }

        .welcome-screen p {
            font-size: 14px;
            color: var(--muted);
        }

        .quick-links {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 20px;
        }

        .quick-link {
            padding: 10px 20px;
            border-radius: 8px;
            background: var(--panel);
            border: 1px solid var(--border);
            color: var(--accent);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .quick-link:hover {
            border-color: var(--accent);
            background: var(--accent-dim);
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 24px;
            }
            
            .sidebar {
                display: none;
            }
            
            .toggle-btn {
                display: none;
            }
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-container">
            <img src="taclogos/green.png" alt="Logo" class="logo" id="logo">
        </div>

        <nav class="nav-items">
            <a href__="index.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span>Home</span>
            </a>

            <a href__="chat.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                    <circle cx="8" cy="10" r="1.5"/>
                    <circle cx="12" cy="10" r="1.5"/>
                    <circle cx="16" cy="10" r="1.5"/>
                </svg>
                <span>Chat</span>
            </a>

            <a href__="notgames.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21.58 16.09l-1.09-7.66A3.996 3.996 0 0016.53 5H7.47a3.996 3.996 0 00-3.96 3.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19h0c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75h0c1.55 0 2.75-1.37 2.53-2.91zM11 11H9v2H8v-2H6v-1h2V8h1v2h2v1zm4-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm2 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z"/>
                </svg>
                <span>Games</span>
            </a>

            <a href__="phone.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17 1.01L7 1c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-1.99-2-1.99zM17 19H7V5h10v14z"/>
                </svg>
                <span>Phone</span>
            </a>

            <a href__="apps.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"/>
                </svg>
                <span>All Apps</span>
            </a>
        </nav>
    </aside>

    <button class="toggle-btn" id="toggleBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 18 9 12 15 6"/>
        </svg>
    </button>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Browser Toolbar -->
        <div class="browser-toolbar">
            <div class="nav-buttons">
                <button class="nav-btn" id="backBtn" title="Go Back" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                </button>
                <button class="nav-btn" id="forwardBtn" title="Go Forward" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"/>
                    </svg>
                </button>
                <button class="nav-btn" id="refreshBtn" title="Refresh">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                    </svg>
                </button>
            </div>
            <div class="url-container">
                <input type="text" class="url-input" id="urlInput" placeholder="Enter URL (e.g., https://example.com)" autofocus>
                <button class="go-btn" id="goBtn">Go</button>
            </div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar" id="tabBar">
            <!-- Tabs will be inserted here by JS -->
            <button class="new-tab-btn" id="newTabBtn" title="New Tab">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            </button>
        </div>

        <!-- Browser Frame -->
        <div class="browser-frame" id="browserFrame">
            <div class="loading-bar" id="loadingBar"></div>
            
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <h1>TAC Browser</h1>
                <p>Enter a URL above to browse the web</p>
                <div class="quick-links"></div>
            </div>

            <!-- Error Overlay -->
            <div class="error-overlay" id="errorOverlay">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <h2>This site can't be loaded in an iframe</h2>
                <p>The website you're trying to visit has security restrictions that prevent it from being displayed here. Would you like to open it in a new tab instead?</p>
                <button class="open-blank-btn" id="openBlankBtn">Open in New Tab</button>
            </div>
        </div>
    </main>

    <script>
        // Theme Colors
        const themeColors = {
            green: { primary: '#22c55e', dim: 'rgba(34, 197, 94, 0.1)', shadow: 'rgba(34, 197, 94, 0.15)' },
            blue: { primary: '#3b82f6', dim: 'rgba(59, 130, 246, 0.1)', shadow: 'rgba(59, 130, 246, 0.15)' },
            red: { primary: '#ef4444', dim: 'rgba(239, 68, 68, 0.1)', shadow: 'rgba(239, 68, 68, 0.15)' },
            cyan: { primary: '#06b6d4', dim: 'rgba(6, 182, 212, 0.1)', shadow: 'rgba(6, 182, 212, 0.15)' },
            pink: { primary: '#ec4899', dim: 'rgba(236, 72, 153, 0.1)', shadow: 'rgba(236, 72, 153, 0.15)' },
            purple: { primary: '#8b5cf6', dim: 'rgba(139, 92, 246, 0.1)', shadow: 'rgba(139, 92, 246, 0.15)' },
            yellow: { primary: '#eab308', dim: 'rgba(234, 179, 8, 0.1)', shadow: 'rgba(234, 179, 8, 0.15)' },
            orange: { primary: '#f97316', dim: 'rgba(249, 115, 22, 0.1)', shadow: 'rgba(249, 115, 22, 0.15)' },
            white: { primary: '#ffffff', dim: 'rgba(255, 255, 255, 0.1)', shadow: 'rgba(255, 255, 255, 0.15)' },
            whiteout: { primary: '#ffffff', dim: 'rgba(255, 255, 255, 0.05)', shadow: 'rgba(255, 255, 255, 0.1)' }
        };

        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'green';
            const colors = themeColors[theme] || themeColors.green;
            document.documentElement.style.setProperty('--accent', colors.primary);
            document.documentElement.style.setProperty('--accent-dim', colors.dim);
            const logo = document.getElementById('logo');
            if (logo) logo.src = 'taclogos/' + theme + '.png';
            const sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.boxShadow = '0 0 20px ' + colors.shadow;
        }

        applyTheme();

        window.addEventListener('storage', function(e) {
            if (e.key === 'theme') applyTheme();
        });

        // Sidebar Toggle
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggleBtn');
        const mainContent = document.getElementById('mainContent');

        toggleBtn.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            toggleBtn.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });

        // DOM references
        const urlInput = document.getElementById('urlInput');
        const goBtn = document.getElementById('goBtn');
        const backBtn = document.getElementById('backBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const browserFrameContainer = document.getElementById('browserFrame');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const errorOverlay = document.getElementById('errorOverlay');
        const openBlankBtn = document.getElementById('openBlankBtn');
        const loadingBar = document.getElementById('loadingBar');
        const tabBar = document.getElementById('tabBar');
        const newTabBtn = document.getElementById('newTabBtn');

        // ===== TAB SYSTEM =====
        let tabs = [];
        let activeTabId = null;
        let nextTabId = 1;

        function createTab(url) {
            const id = nextTabId++;
            const iframe = document.createElement('iframe');
            iframe.className = 'browser-iframe';
            iframe.style.display = 'none';
            iframe.setAttribute('sandbox', 'allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation');
            browserFrameContainer.appendChild(iframe);

            iframe.addEventListener('load', function() {
                hideLoading();
            });

            iframe.addEventListener('error', function() {
                hideLoading();
                if (activeTabId === id) showError();
            });

            const tab = {
                id: id,
                title: 'New Tab',
                url: url || '',
                iframe: iframe,
                history: [],
                historyIndex: -1
            };

            tabs.push(tab);
            renderTabs();
            switchToTab(id);

            if (url) {
                navigateTo(url, true);
            }

            return tab;
        }

        function renderTabs() {
            // Remove old tab elements (but not the new-tab button)
            var oldTabs = tabBar.querySelectorAll('.tab');
            oldTabs.forEach(function(el) { el.remove(); });

            tabs.forEach(function(tab) {
                var el = document.createElement('div');
                el.className = 'tab' + (tab.id === activeTabId ? ' active' : '');
                el.setAttribute('data-tab-id', tab.id);

                var titleSpan = document.createElement('span');
                titleSpan.className = 'tab-title';
                titleSpan.textContent = tab.title || 'New Tab';
                el.appendChild(titleSpan);

                var closeBtn = document.createElement('button');
                closeBtn.className = 'tab-close';
                closeBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>';
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    closeTab(tab.id);
                });
                el.appendChild(closeBtn);

                el.addEventListener('click', function() {
                    switchToTab(tab.id);
                });

                tabBar.insertBefore(el, newTabBtn);
            });
        }

        function switchToTab(id) {
            activeTabId = id;

            tabs.forEach(function(tab) {
                if (tab.id === id) {
                    tab.iframe.style.display = 'block';
                } else {
                    tab.iframe.style.display = 'none';
                }
            });

            var tab = getActiveTab();
            if (tab) {
                urlInput.value = tab.url || '';
                if (tab.url) {
                    welcomeScreen.style.display = 'none';
                } else {
                    welcomeScreen.style.display = 'flex';
                }
                errorOverlay.classList.remove('visible');
                updateNavButtons();
            }

            renderTabs();
        }

        function closeTab(id) {
            var index = tabs.findIndex(function(t) { return t.id === id; });
            if (index === -1) return;

            var tab = tabs[index];
            tab.iframe.remove();
            tabs.splice(index, 1);

            if (tabs.length === 0) {
                createTab();
                return;
            }

            if (activeTabId === id) {
                var newIndex = Math.min(index, tabs.length - 1);
                switchToTab(tabs[newIndex].id);
            } else {
                renderTabs();
            }
        }

        function getActiveTab() {
            return tabs.find(function(t) { return t.id === activeTabId; });
        }

        function getTabTitle(url) {
            try {
                var hostname = new URL(url).hostname;
                return hostname.replace('www.', '');
            } catch (e) {
                return url || 'New Tab';
            }
        }

        // ===== URL & NAVIGATION =====
        function validURL(str) {
            var pattern = new RegExp('^(https?:\\/\\/)?'+
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+
                '((\\d{1,3}\\.){3}\\d{1,3}))'+
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+
                '(\\?[;&a-z\\d%_.~+=-]*)?'+
                '(\\#[-a-z\\d_]*)?$','i');
            return !!pattern.test(str);
        }

        function normalizeUrl(url) {
            url = url.trim();
            if (!url) return '';
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            return url;
        }

        function showLoading() {
            loadingBar.classList.add('active');
        }

        function hideLoading() {
            loadingBar.classList.remove('active');
        }

        function updateNavButtons() {
            var tab = getActiveTab();
            if (!tab) {
                backBtn.disabled = true;
                forwardBtn.disabled = true;
                return;
            }
            backBtn.disabled = tab.historyIndex <= 0;
            forwardBtn.disabled = tab.historyIndex >= tab.history.length - 1;
        }

        function navigateTo(url, addToHistory) {
            if (addToHistory === undefined) addToHistory = true;
            url = normalizeUrl(url);
            if (!url || !validURL(url)) return;

            var tab = getActiveTab();
            if (!tab) return;

            tab.url = url;
            tab.title = getTabTitle(url);
            urlInput.value = url;

            welcomeScreen.style.display = 'none';
            errorOverlay.classList.remove('visible');
            tab.iframe.style.display = 'block';

            showLoading();

            if (addToHistory) {
                tab.history = tab.history.slice(0, tab.historyIndex + 1);
                tab.history.push(url);
                tab.historyIndex = tab.history.length - 1;
            }

            updateNavButtons();
            renderTabs();

            tab.iframe.src = url;
        }

        function showError() {
            errorOverlay.classList.add('visible');
            var tab = getActiveTab();
            if (tab) tab.iframe.style.display = 'none';
        }

        // ===== EVENT LISTENERS =====
        newTabBtn.addEventListener('click', function() {
            createTab();
        });

        goBtn.addEventListener('click', function() {
            navigateTo(urlInput.value);
        });

        urlInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') navigateTo(urlInput.value);
        });

        backBtn.addEventListener('click', function() {
            var tab = getActiveTab();
            if (tab && tab.historyIndex > 0) {
                tab.historyIndex--;
                navigateTo(tab.history[tab.historyIndex], false);
            }
        });

        forwardBtn.addEventListener('click', function() {
            var tab = getActiveTab();
            if (tab && tab.historyIndex < tab.history.length - 1) {
                tab.historyIndex++;
                navigateTo(tab.history[tab.historyIndex], false);
            }
        });

        refreshBtn.addEventListener('click', function() {
            var tab = getActiveTab();
            if (tab && tab.url) {
                tab.iframe.src = tab.url;
                showLoading();
            }
        });

        openBlankBtn.addEventListener('click', function() {
            var tab = getActiveTab();
            var url = tab ? tab.url : '';
            if (url) {
                var newWindow = window.open('about:blank', '_blank');
                if (newWindow) {
                    newWindow.document.write(
                        '<!DOCTYPE html><html><head>
<script src="guard.js"></script>
    <link rel="stylesheet" href="rightclick.css">
    <link rel="stylesheet" href="custom-cursor.css"><link rel="stylesheet" href__="rightclick.css"><link rel="stylesheet" href__="custom-cursor.css"><title>TAC Browser</title></head>' +
                        '<body style="margin:0;padding:0;overflow:hidden;">' +
                        '<iframe style="width:100%;height:100vh;border:none;position:fixed;top:0;left:0;right:0;bottom:0;" src="' + url + '" sandbox="allow-forms allow-modals allow-orientation-lock allow-pointer-lock allow-popups allow-popups-to-escape-sandbox allow-presentation allow-same-origin allow-scripts allow-top-navigation allow-top-navigation-by-user-activation"></iframe>' +
                        '<script src="custom-cursor.js"><\/script><script src="rightclick.js"><\/script><script src="panic-key.js"><\/script><script src="idle-dvd.js"><\/script>' +
                        '    <script src="timeTracker.js"></script>
</body></html>'
                    );
                    newWindow.document.close();
                }
            }
        });

        // Keyboard shortcut: Ctrl+T for new tab
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 't') {
                e.preventDefault();
                createTab();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'w') {
                e.preventDefault();
                if (activeTabId !== null) closeTab(activeTabId);
            }
        });

        // Initialize with one tab
        createTab();
    </script>

    <script src="custom-cursor.js"></script>
    <script src="rightclick.js"></script>
    <script src="panic-key.js"></script>
    <script src="idle-dvd.js"></script>
    <script src="timeTracker.js"></script>
</body>
</html>